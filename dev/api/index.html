<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API Reference · RepertoireMetrics.jl</title><meta name="title" content="API Reference · RepertoireMetrics.jl"/><meta property="og:title" content="API Reference · RepertoireMetrics.jl"/><meta property="twitter:title" content="API Reference · RepertoireMetrics.jl"/><meta name="description" content="Documentation for RepertoireMetrics.jl."/><meta property="og:description" content="Documentation for RepertoireMetrics.jl."/><meta property="twitter:description" content="Documentation for RepertoireMetrics.jl."/><meta property="og:url" content="https://mashu.github.io/RepertoireMetrics.jl/api/"/><meta property="twitter:url" content="https://mashu.github.io/RepertoireMetrics.jl/api/"/><link rel="canonical" href="https://mashu.github.io/RepertoireMetrics.jl/api/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">RepertoireMetrics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quickstart/">Quick Start</a></li><li><a class="tocitem" href="../metrics/">Metrics</a></li><li><a class="tocitem" href="../composable/">Composable Metrics</a></li><li class="is-active"><a class="tocitem" href>API Reference</a><ul class="internal"><li><a class="tocitem" href="#Lineage-Definition-Strategies"><span>Lineage Definition Strategies</span></a></li><li><a class="tocitem" href="#Data-Structures"><span>Data Structures</span></a></li><li><a class="tocitem" href="#Reading-Data"><span>Reading Data</span></a></li><li><a class="tocitem" href="#Computing-Metrics"><span>Computing Metrics</span></a></li><li><a class="tocitem" href="#Sampling"><span>Sampling</span></a></li><li><a class="tocitem" href="#Exporting-Results"><span>Exporting Results</span></a></li><li><a class="tocitem" href="#Length-Statistics"><span>Length Statistics</span></a></li><li><a class="tocitem" href="#Index"><span>Index</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API Reference</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h1><h2 id="Lineage-Definition-Strategies"><a class="docs-heading-anchor" href="#Lineage-Definition-Strategies">Lineage Definition Strategies</a><a id="Lineage-Definition-Strategies-1"></a><a class="docs-heading-anchor-permalink" href="#Lineage-Definition-Strategies" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="RepertoireMetrics.AbstractLineageDefinition"><a class="docstring-binding" href="#RepertoireMetrics.AbstractLineageDefinition"><code>RepertoireMetrics.AbstractLineageDefinition</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">AbstractLineageDefinition</code></pre><p>Abstract supertype for all lineage definition strategies. Concrete subtypes define how sequences are grouped into clonal lineages.</p><p><strong>Implementing a new strategy</strong></p><p>To implement a new lineage definition strategy:</p><ol><li>Create a subtype of <code>AbstractLineageDefinition</code></li><li>Implement <code>lineage_key(strategy, row)</code> returning a hashable key</li></ol></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.LineageIDDefinition"><a class="docstring-binding" href="#RepertoireMetrics.LineageIDDefinition"><code>RepertoireMetrics.LineageIDDefinition</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">LineageIDDefinition &lt;: AbstractLineageDefinition</code></pre><p>Define lineages using the <code>lineage_id</code> column directly. This is the simplest strategy when lineage assignment has already been performed.</p><p><strong>Fields</strong></p><ul><li><code>column::Symbol</code>: Column name containing lineage IDs (default: <code>:lineage_id</code>)</li></ul></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.VJCdr3Definition"><a class="docstring-binding" href="#RepertoireMetrics.VJCdr3Definition"><code>RepertoireMetrics.VJCdr3Definition</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">VJCdr3Definition &lt;: AbstractLineageDefinition</code></pre><p>Define lineages using the combination of V gene, J gene, and CDR3 sequence. This is consistent with LineageCollapse.jl&#39;s default behavior.</p><p><strong>Fields</strong></p><ul><li><code>v_column::Symbol</code>: Column name for V gene call (default: <code>:v_call</code>)</li><li><code>j_column::Symbol</code>: Column name for J gene call (default: <code>:j_call</code>)</li><li><code>cdr3_column::Symbol</code>: Column name for CDR3 sequence (default: <code>:cdr3</code>)</li><li><code>use_first_allele::Bool</code>: Use only first allele from calls (default: <code>true</code>)</li></ul></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.CustomDefinition"><a class="docstring-binding" href="#RepertoireMetrics.CustomDefinition"><code>RepertoireMetrics.CustomDefinition</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">CustomDefinition{F} &lt;: AbstractLineageDefinition</code></pre><p>Define lineages using a custom function that extracts a key from each row.</p><p><strong>Fields</strong></p><ul><li><code>key_func::F</code>: Function <code>row -&gt; key</code> that returns a hashable lineage key</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs"># Group by V gene family only
strategy = CustomDefinition(row -&gt; first(split(string(row.v_call), &quot;-&quot;)))</code></pre></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.lineage_key"><a class="docstring-binding" href="#RepertoireMetrics.lineage_key"><code>RepertoireMetrics.lineage_key</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">lineage_key(strategy::AbstractLineageDefinition, row) -&gt; key</code></pre><p>Extract a lineage key from a data row using the given strategy. Returns a hashable value that identifies the lineage.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.first_allele"><a class="docstring-binding" href="#RepertoireMetrics.first_allele"><code>RepertoireMetrics.first_allele</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">first_allele(call::AbstractString) -&gt; String</code></pre><p>Extract the first allele from a gene call string. Handles comma-separated multiple calls and allele notation.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs">first_allele(&quot;IGHV1-2*01,IGHV1-2*02&quot;) # &quot;IGHV1-2*01&quot;
first_allele(&quot;IGHV1-2*01&quot;)             # &quot;IGHV1-2*01&quot;</code></pre></div></section></details></article><h2 id="Data-Structures"><a class="docs-heading-anchor" href="#Data-Structures">Data Structures</a><a id="Data-Structures-1"></a><a class="docs-heading-anchor-permalink" href="#Data-Structures" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="RepertoireMetrics.Repertoire"><a class="docstring-binding" href="#RepertoireMetrics.Repertoire"><code>RepertoireMetrics.Repertoire</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">Repertoire{T&lt;:Real}</code></pre><p>Immutable representation of a B cell repertoire for diversity analysis. Stores lineage counts in a type-stable manner for efficient metric computation.</p><p><strong>Type parameter</strong></p><ul><li><code>T</code>: Numeric type for counts (typically <code>Int</code> or <code>Float64</code>)</li></ul><p><strong>Fields</strong></p><ul><li><code>counts::Vector{T}</code>: Sorted vector of lineage counts (descending order)</li><li><code>lineage_ids::Vector{String}</code>: Lineage identifiers corresponding to counts</li><li><code>donor_id::String</code>: Identifier for the donor/sample</li><li><code>total_count::T</code>: Total count (cached for efficiency)</li><li><code>metadata::Dict{String,Any}</code>: Optional metadata (flexible storage for extensibility;  known keys like <code>&quot;length_stats&quot;</code> contain typed values)</li></ul><p><strong>Construction</strong></p><p>Use the constructors or <code>read_repertoire</code> for type-safe creation.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs"># From counts directly
rep = Repertoire([100, 50, 25, 10, 5], donor_id=&quot;Donor1&quot;)

# From DataFrame
rep = read_repertoire(&quot;data.tsv&quot;, VJCdr3Definition())</code></pre></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.RepertoireCollection"><a class="docstring-binding" href="#RepertoireMetrics.RepertoireCollection"><code>RepertoireMetrics.RepertoireCollection</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">RepertoireCollection{T&lt;:Real}</code></pre><p>Collection of repertoires from multiple donors for comparative analysis.</p><p><strong>Fields</strong></p><ul><li><code>repertoires::Vector{Repertoire{T}}</code>: Vector of repertoires</li><li><code>donor_ids::Vector{String}</code>: Donor identifiers (for quick lookup)</li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">collection = RepertoireCollection([rep1, rep2, rep3])
metrics = compute_metrics(collection)  # Returns vector of DiversityMetrics</code></pre></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.richness"><a class="docstring-binding" href="#RepertoireMetrics.richness"><code>RepertoireMetrics.richness</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">richness(rep::Repertoire) -&gt; Int</code></pre><p>Return the number of unique lineages (richness/species count).</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.total_count"><a class="docstring-binding" href="#RepertoireMetrics.total_count"><code>RepertoireMetrics.total_count</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">total_count(rep::Repertoire) -&gt; T</code></pre><p>Return the total count across all lineages.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.frequencies"><a class="docstring-binding" href="#RepertoireMetrics.frequencies"><code>RepertoireMetrics.frequencies</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">frequencies(rep::Repertoire{T}) -&gt; Vector{Float64}</code></pre><p>Return normalized frequencies (proportions) for each lineage. Frequencies sum to 1.0.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.counts"><a class="docstring-binding" href="#RepertoireMetrics.counts"><code>RepertoireMetrics.counts</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">counts(rep::Repertoire) -&gt; Vector{T}</code></pre><p>Return the count vector (sorted descending).</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.lineage_ids"><a class="docstring-binding" href="#RepertoireMetrics.lineage_ids"><code>RepertoireMetrics.lineage_ids</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">lineage_ids(rep::Repertoire) -&gt; Vector{String}</code></pre><p>Return lineage identifiers (sorted by count descending).</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.donor_id"><a class="docstring-binding" href="#RepertoireMetrics.donor_id"><code>RepertoireMetrics.donor_id</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">donor_id(rep::Repertoire) -&gt; String</code></pre><p>Return the donor/sample identifier.</p></div></section></details></article><h2 id="Reading-Data"><a class="docs-heading-anchor" href="#Reading-Data">Reading Data</a><a id="Reading-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-Data" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="RepertoireMetrics.read_repertoire"><a class="docstring-binding" href="#RepertoireMetrics.read_repertoire"><code>RepertoireMetrics.read_repertoire</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">read_repertoire(
    filepath::AbstractString,
    strategy::AbstractLineageDefinition;
    count_column::Union{Symbol,Nothing} = :count,
    donor_id::String = &quot;&quot;,
    donor_column::Union{Symbol,Nothing} = nothing,
    length_column::Union{Symbol,Nothing} = nothing,
    length_aa::Bool = false,
    kwargs...
) -&gt; Repertoire{Int}</code></pre><p>Read a MIAIRR file (TSV, CSV, or gzipped) and convert to a Repertoire. The delimiter is auto-detected by CSV.jl.</p><p><strong>Arguments</strong></p><ul><li><code>filepath</code>: Path to file (supports .tsv, .csv, .tsv.gz, .csv.gz)</li><li><code>strategy</code>: Lineage definition strategy</li><li><code>count_column</code>: Column containing sequence counts (default <code>:count</code>)</li><li><code>donor_id</code>: Donor/sample identifier</li><li><code>donor_column</code>: Column to extract donor ID from (e.g., <code>:library_id</code>)</li><li><code>length_column</code>: Column to compute length statistics from (e.g., <code>:cdr3</code>)</li><li><code>length_aa</code>: If <code>true</code>, <code>length_column</code> contains amino acid sequences</li><li><code>kwargs...</code>: Additional arguments passed to <code>CSV.read</code></li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs"># Using lineage_id column
rep = read_repertoire(&quot;collapsed_data.tsv&quot;, LineageIDDefinition())

# Using V-J-CDR3 definition with CDR3 length stats
rep = read_repertoire(&quot;sequences.tsv&quot;, VJCdr3Definition(); length_column=:cdr3)

# With donor ID from file
rep = read_repertoire(&quot;data.tsv&quot;, VJCdr3Definition(); donor_column=:library_id)

# Compute length from amino acid column
rep = read_repertoire(&quot;data.tsv&quot;, VJCdr3Definition(); 
    length_column=:cdr3_aa, length_aa=true)</code></pre></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.read_repertoires"><a class="docstring-binding" href="#RepertoireMetrics.read_repertoires"><code>RepertoireMetrics.read_repertoires</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">read_repertoires(
    filepaths::Vector{&lt;:AbstractString},
    strategy::AbstractLineageDefinition;
    kwargs...
) -&gt; RepertoireCollection{Int}</code></pre><p>Read multiple MIAIRR TSV files and return a collection.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">files = [&quot;donor1.tsv&quot;, &quot;donor2.tsv&quot;, &quot;donor3.tsv&quot;]
collection = read_repertoires(files, VJCdr3Definition())
all_metrics = compute_metrics(collection)</code></pre></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.read_repertoires_from_directory"><a class="docstring-binding" href="#RepertoireMetrics.read_repertoires_from_directory"><code>RepertoireMetrics.read_repertoires_from_directory</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">read_repertoires_from_directory(
    dirpath::AbstractString,
    strategy::AbstractLineageDefinition;
    pattern::Regex = r&quot;\.tsv$&quot;i,
    kwargs...
) -&gt; RepertoireCollection{Int}</code></pre><p>Read all matching files from a directory and return a collection.</p><p><strong>Arguments</strong></p><ul><li><code>dirpath</code>: Path to directory containing TSV files</li><li><code>strategy</code>: Lineage definition strategy</li><li><code>pattern</code>: Regex pattern to match filenames (default: <code>.tsv</code> files)</li><li><code>kwargs...</code>: Additional arguments passed to <code>read_repertoire</code></li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">collection = read_repertoires_from_directory(&quot;data/&quot;, VJCdr3Definition())</code></pre></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.repertoire_from_dataframe"><a class="docstring-binding" href="#RepertoireMetrics.repertoire_from_dataframe"><code>RepertoireMetrics.repertoire_from_dataframe</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">repertoire_from_dataframe(
    df::DataFrame,
    strategy::AbstractLineageDefinition;
    count_column::Union{Symbol,Nothing} = :count,
    donor_id::String = &quot;&quot;,
    donor_column::Union{Symbol,Nothing} = nothing,
    length_column::Union{Symbol,Nothing} = nothing,
    length_aa::Bool = false
) -&gt; Repertoire{Int}</code></pre><p>Convert a DataFrame to a Repertoire using the specified lineage definition strategy.</p><p><strong>Arguments</strong></p><ul><li><code>df</code>: Input DataFrame in MIAIRR format</li><li><code>strategy</code>: Lineage definition strategy (e.g., <code>VJCdr3Definition()</code>, <code>LineageIDDefinition()</code>)</li><li><code>count_column</code>: Column containing sequence counts (default <code>:count</code>). If <code>nothing</code> or  column doesn&#39;t exist, each row counts as 1.</li><li><code>donor_id</code>: Donor/sample identifier. If empty and <code>donor_column</code> is specified,  extracts from first row.</li><li><code>donor_column</code>: Column containing donor IDs (e.g., <code>:library_id</code>)</li><li><code>length_column</code>: Column to compute length statistics from (e.g., <code>:cdr3</code>, <code>:junction</code>). If <code>nothing</code> (default), no length statistics are computed.</li><li><code>length_aa</code>: If <code>true</code>, <code>length_column</code> contains amino acid sequences. If <code>false</code> (default), assumes nucleotide sequences and converts to amino acid length (÷3).</li></ul><p><strong>Returns</strong></p><p>A <code>Repertoire{Int}</code> with aggregated lineage counts. If <code>length_column</code> is specified, length statistics are stored in metadata and accessible via composable metrics like <code>MeanLength()</code>, <code>MedianLength()</code>, etc.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">df = CSV.read(&quot;sequences.tsv&quot;, DataFrame)

# Basic repertoire
rep = repertoire_from_dataframe(df, VJCdr3Definition())

# With CDR3 length statistics
rep = repertoire_from_dataframe(df, VJCdr3Definition(); length_column=:cdr3)
println(mean_length(rep))  # Access via function
metrics = compute_metrics(rep, MeanLength() + MedianLength())  # Or compose

# Using amino acid column directly
rep = repertoire_from_dataframe(df, VJCdr3Definition(); 
    length_column=:cdr3_aa, length_aa=true)</code></pre></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.split_by_donor"><a class="docstring-binding" href="#RepertoireMetrics.split_by_donor"><code>RepertoireMetrics.split_by_donor</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">split_by_donor(
    df::DataFrame,
    donor_column::Symbol,
    strategy::AbstractLineageDefinition;
    kwargs...
) -&gt; RepertoireCollection{Int}</code></pre><p>Split a multi-donor DataFrame into separate Repertoires by donor.</p><p><strong>Arguments</strong></p><ul><li><code>df</code>: DataFrame containing data from multiple donors</li><li><code>donor_column</code>: Column containing donor identifiers</li><li><code>strategy</code>: Lineage definition strategy</li><li><code>kwargs...</code>: Additional arguments passed to <code>repertoire_from_dataframe</code></li></ul><p><strong>Example</strong></p><pre><code class="language-julia hljs">df = CSV.read(&quot;all_donors.tsv&quot;, DataFrame)
collection = split_by_donor(df, :library_id, VJCdr3Definition())</code></pre></div></section></details></article><h2 id="Computing-Metrics"><a class="docs-heading-anchor" href="#Computing-Metrics">Computing Metrics</a><a id="Computing-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-Metrics" title="Permalink"></a></h2><h3 id="Main-Functions"><a class="docs-heading-anchor" href="#Main-Functions">Main Functions</a><a id="Main-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Main-Functions" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="RepertoireMetrics.compute_metrics"><a class="docstring-binding" href="#RepertoireMetrics.compute_metrics"><code>RepertoireMetrics.compute_metrics</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">compute_metrics(rep::Repertoire) -&gt; Metrics
compute_metrics(rep::Repertoire, metrics::MetricSet) -&gt; Metrics</code></pre><p>Compute metrics for a repertoire. Without a MetricSet argument, computes all metrics.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs"># Compute all metrics (default)
result = compute_metrics(rep)

# Compute specific metrics
result = compute_metrics(rep, ShannonEntropy() + Clonality() + D50())

# Use predefined sets
result = compute_metrics(rep, DIVERSITY_METRICS)</code></pre></div></section><section><div><pre><code class="language-julia hljs">compute_metrics(collection::RepertoireCollection) -&gt; Vector{Metrics}
compute_metrics(collection::RepertoireCollection, metrics::MetricSet) -&gt; Vector{Metrics}</code></pre><p>Compute metrics for all repertoires in a collection.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.Metrics"><a class="docstring-binding" href="#RepertoireMetrics.Metrics"><code>RepertoireMetrics.Metrics</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">Metrics &lt;: AbstractMetricResult</code></pre><p>Result container for computed metrics. Access values by property name. All values are stored as <code>Float64</code> for type stability.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">result = compute_metrics(rep)
println(result.shannon_entropy)
println(result.clonality)
println(result.d50)</code></pre></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.compute_metric"><a class="docstring-binding" href="#RepertoireMetrics.compute_metric"><code>RepertoireMetrics.compute_metric</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">compute_metric(rep::Repertoire, metric::AbstractMetric) -&gt; value</code></pre><p>Compute a single metric for a repertoire.</p></div></section></details></article><h3 id="Individual-Metric-Functions"><a class="docs-heading-anchor" href="#Individual-Metric-Functions">Individual Metric Functions</a><a id="Individual-Metric-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Individual-Metric-Functions" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="RepertoireMetrics.shannon_entropy"><a class="docstring-binding" href="#RepertoireMetrics.shannon_entropy"><code>RepertoireMetrics.shannon_entropy</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">shannon_entropy(freqs::Vector{Float64}) -&gt; Float64</code></pre><p>Compute Shannon entropy H = -Σ(pᵢ log pᵢ) using natural logarithm. Zero frequencies are handled correctly (0 * log(0) = 0).</p></div></section><section><div><pre><code class="language-julia hljs">shannon_entropy(rep::Repertoire) -&gt; Float64</code></pre><p>Compute Shannon entropy for a repertoire.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.simpson_index"><a class="docstring-binding" href="#RepertoireMetrics.simpson_index"><code>RepertoireMetrics.simpson_index</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">simpson_index(freqs::Vector{Float64}) -&gt; Float64</code></pre><p>Compute Simpson&#39;s index D = Σpᵢ². This is the probability that two randomly selected individuals belong to the same lineage.</p></div></section><section><div><pre><code class="language-julia hljs">simpson_index(rep::Repertoire) -&gt; Float64</code></pre><p>Compute Simpson&#39;s index for a repertoire.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.simpson_diversity"><a class="docstring-binding" href="#RepertoireMetrics.simpson_diversity"><code>RepertoireMetrics.simpson_diversity</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">simpson_diversity(rep::Repertoire) -&gt; Float64</code></pre><p>Compute Simpson&#39;s diversity (1 - D) for a repertoire.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.inverse_simpson"><a class="docstring-binding" href="#RepertoireMetrics.inverse_simpson"><code>RepertoireMetrics.inverse_simpson</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">inverse_simpson(rep::Repertoire) -&gt; Float64</code></pre><p>Compute inverse Simpson index (1/D) for a repertoire.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.berger_parker_index"><a class="docstring-binding" href="#RepertoireMetrics.berger_parker_index"><code>RepertoireMetrics.berger_parker_index</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">berger_parker_index(freqs::Vector{Float64}) -&gt; Float64</code></pre><p>Compute Berger-Parker index: proportion of the most abundant lineage. Assumes frequencies are sorted in descending order.</p></div></section><section><div><pre><code class="language-julia hljs">berger_parker_index(rep::Repertoire) -&gt; Float64</code></pre><p>Compute Berger-Parker index for a repertoire.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.gini_coefficient"><a class="docstring-binding" href="#RepertoireMetrics.gini_coefficient"><code>RepertoireMetrics.gini_coefficient</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">gini_coefficient(freqs::Vector{Float64}) -&gt; Float64</code></pre><p>Compute Gini coefficient measuring inequality in lineage abundances. Returns 0 for perfect equality, approaches 1 for maximum inequality.</p></div></section><section><div><pre><code class="language-julia hljs">gini_coefficient(rep::Repertoire) -&gt; Float64</code></pre><p>Compute Gini coefficient for a repertoire.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.clonality"><a class="docstring-binding" href="#RepertoireMetrics.clonality"><code>RepertoireMetrics.clonality</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">clonality(rep::Repertoire) -&gt; Float64</code></pre><p>Compute clonality: 1 - normalized Shannon entropy. High clonality indicates oligoclonal expansion. Range: [0, 1] where 1 = maximally clonal (single dominant lineage).</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.evenness"><a class="docstring-binding" href="#RepertoireMetrics.evenness"><code>RepertoireMetrics.evenness</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">evenness(rep::Repertoire) -&gt; Float64</code></pre><p>Compute Pielou&#39;s evenness J = H / H_max. Range: [0, 1] where 1 = perfectly even distribution.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.d50"><a class="docstring-binding" href="#RepertoireMetrics.d50"><code>RepertoireMetrics.d50</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">d50(counts::Vector{&lt;:Real}) -&gt; Int</code></pre><p>Compute D50: minimum number of lineages comprising 50% of total repertoire. Assumes counts are sorted in descending order.</p></div></section><section><div><pre><code class="language-julia hljs">d50(rep::Repertoire) -&gt; Int</code></pre><p>Compute D50 for a repertoire.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.chao1"><a class="docstring-binding" href="#RepertoireMetrics.chao1"><code>RepertoireMetrics.chao1</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">chao1(counts::Vector{&lt;:Integer}) -&gt; Float64</code></pre><p>Compute Chao1 richness estimator. Estimates total species richness including unobserved species.</p><p>Formula: S<em>chao1 = S</em>obs + f₁²/(2f₂) where f₁ = singletons, f₂ = doubletons</p><p>If f₂ = 0, uses bias-corrected formula: S_obs + f₁(f₁-1)/2</p></div></section><section><div><pre><code class="language-julia hljs">chao1(rep::Repertoire) -&gt; Float64</code></pre><p>Compute Chao1 richness estimator for a repertoire.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.hill_number"><a class="docstring-binding" href="#RepertoireMetrics.hill_number"><code>RepertoireMetrics.hill_number</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">hill_number(freqs::Vector{Float64}, q::Real) -&gt; Float64</code></pre><p>Compute Hill number of order q. Hill numbers provide a unified framework for diversity metrics.</p><p><strong>Special cases</strong></p><ul><li>q=0: Richness (number of species with non-zero frequency)</li><li>q=1: exp(Shannon entropy) - uses L&#39;Hôpital&#39;s rule limit</li><li>q=2: Inverse Simpson (1/Σpᵢ²)</li><li>q→∞: 1/max(pᵢ) (reciprocal of Berger-Parker)</li></ul><p><strong>Formula</strong></p><p>ᵍD = (Σpᵢᵍ)^(1/(1-q)) for q ≠ 1</p></div></section><section><div><pre><code class="language-julia hljs">hill_number(rep::Repertoire, q::Real) -&gt; HillNumber{Q}</code></pre><p>Compute Hill number of order q for a repertoire. Returns a typed <code>HillNumber{Q}</code> for compile-time known orders.</p></div></section></details></article><h3 id="Hill-Numbers"><a class="docs-heading-anchor" href="#Hill-Numbers">Hill Numbers</a><a id="Hill-Numbers-1"></a><a class="docs-heading-anchor-permalink" href="#Hill-Numbers" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="RepertoireMetrics.HillNumber"><a class="docstring-binding" href="#RepertoireMetrics.HillNumber"><code>RepertoireMetrics.HillNumber</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">HillNumber{Q} &lt;: AbstractMetricResult</code></pre><p>Hill number of order Q, providing a unified framework for diversity.</p><p><strong>Type parameter</strong></p><ul><li><code>Q</code>: Order of the Hill number (compile-time constant for type stability)</li></ul><p><strong>Fields</strong></p><ul><li><code>value::Float64</code>: The computed Hill number</li><li><code>richness::Int</code>: Number of unique lineages</li><li><code>total_count::Int</code>: Total count</li></ul><p><strong>Special cases</strong></p><ul><li>Q=0: Richness (number of species)</li><li>Q=1: Exponential of Shannon entropy</li><li>Q=2: Inverse Simpson index</li><li>Q=∞: Reciprocal of Berger-Parker index</li></ul></div></section></details></article><h3 id="Composable-Metric-Selection"><a class="docs-heading-anchor" href="#Composable-Metric-Selection">Composable Metric Selection</a><a id="Composable-Metric-Selection-1"></a><a class="docs-heading-anchor-permalink" href="#Composable-Metric-Selection" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="RepertoireMetrics.AbstractMetric"><a class="docstring-binding" href="#RepertoireMetrics.AbstractMetric"><code>RepertoireMetrics.AbstractMetric</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">AbstractMetric</code></pre><p>Abstract supertype for individual metric selectors. Each concrete subtype represents a specific diversity/clonality metric.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.MetricSet"><a class="docstring-binding" href="#RepertoireMetrics.MetricSet"><code>RepertoireMetrics.MetricSet</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">MetricSet{M&lt;:Tuple}</code></pre><p>A composable set of metrics to compute. Use the <code>+</code> operator to combine metrics.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs"># Select specific metrics
metrics = Richness() + ShannonEntropy() + Clonality()
result = compute_metrics(rep, metrics)

# Use predefined sets
result = compute_metrics(rep, DIVERSITY_METRICS)
result = compute_metrics(rep, ALL_METRICS)

# Default computes all metrics
result = compute_metrics(rep)</code></pre></div></section></details></article><h3 id="Predefined-Metric-Sets"><a class="docs-heading-anchor" href="#Predefined-Metric-Sets">Predefined Metric Sets</a><a id="Predefined-Metric-Sets-1"></a><a class="docs-heading-anchor-permalink" href="#Predefined-Metric-Sets" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="RepertoireMetrics.ALL_METRICS"><a class="docstring-binding" href="#RepertoireMetrics.ALL_METRICS"><code>RepertoireMetrics.ALL_METRICS</code></a> — <span class="docstring-category">Constant</span></summary><section><div><pre><code class="language-julia hljs">ALL_METRICS</code></pre><p>All available metrics. This is the default when calling <code>compute_metrics(rep)</code>.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.DIVERSITY_METRICS"><a class="docstring-binding" href="#RepertoireMetrics.DIVERSITY_METRICS"><code>RepertoireMetrics.DIVERSITY_METRICS</code></a> — <span class="docstring-category">Constant</span></summary><section><div><pre><code class="language-julia hljs">DIVERSITY_METRICS</code></pre><p>Common diversity metrics: Shannon entropy/diversity, Simpson diversity, inverse Simpson.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.CLONALITY_METRICS"><a class="docstring-binding" href="#RepertoireMetrics.CLONALITY_METRICS"><code>RepertoireMetrics.CLONALITY_METRICS</code></a> — <span class="docstring-category">Constant</span></summary><section><div><pre><code class="language-julia hljs">CLONALITY_METRICS</code></pre><p>Metrics focused on clonal expansion: clonality, Gini, Berger-Parker, D50.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.RICHNESS_METRICS"><a class="docstring-binding" href="#RepertoireMetrics.RICHNESS_METRICS"><code>RepertoireMetrics.RICHNESS_METRICS</code></a> — <span class="docstring-category">Constant</span></summary><section><div><pre><code class="language-julia hljs">RICHNESS_METRICS</code></pre><p>Richness-related metrics: observed richness and Chao1 estimator.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.ROBUST_METRICS"><a class="docstring-binding" href="#RepertoireMetrics.ROBUST_METRICS"><code>RepertoireMetrics.ROBUST_METRICS</code></a> — <span class="docstring-category">Constant</span></summary><section><div><pre><code class="language-julia hljs">ROBUST_METRICS</code></pre><p>Depth-robust metrics recommended for comparing samples of different sizes. These metrics are computed from frequencies and are less sensitive to sequencing depth. Includes <code>Depth</code> so you always report sequencing depth alongside comparisons.</p></div></section></details></article><h3 id="Metric-Types"><a class="docs-heading-anchor" href="#Metric-Types">Metric Types</a><a id="Metric-Types-1"></a><a class="docs-heading-anchor-permalink" href="#Metric-Types" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="RepertoireMetrics.Richness"><a class="docstring-binding" href="#RepertoireMetrics.Richness"><code>RepertoireMetrics.Richness</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Richness: Number of unique lineages (S)</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.TotalCount"><a class="docstring-binding" href="#RepertoireMetrics.TotalCount"><code>RepertoireMetrics.TotalCount</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>TotalCount: Total sequence/cell count (N)</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.Depth"><a class="docstring-binding" href="#RepertoireMetrics.Depth"><code>RepertoireMetrics.Depth</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Depth: Sequencing depth (alias for total count, commonly used term)</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.ShannonEntropy"><a class="docstring-binding" href="#RepertoireMetrics.ShannonEntropy"><code>RepertoireMetrics.ShannonEntropy</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>ShannonEntropy: H = -Σ(pᵢ log pᵢ)</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.ShannonDiversity"><a class="docstring-binding" href="#RepertoireMetrics.ShannonDiversity"><code>RepertoireMetrics.ShannonDiversity</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>ShannonDiversity: exp(H) - effective number of lineages</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.NormalizedShannon"><a class="docstring-binding" href="#RepertoireMetrics.NormalizedShannon"><code>RepertoireMetrics.NormalizedShannon</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>NormalizedShannon: H / log(S), normalized to [0,1]</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.SimpsonIndex"><a class="docstring-binding" href="#RepertoireMetrics.SimpsonIndex"><code>RepertoireMetrics.SimpsonIndex</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>SimpsonIndex: D = Σpᵢ² - probability two random sequences are same lineage</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.SimpsonDiversity"><a class="docstring-binding" href="#RepertoireMetrics.SimpsonDiversity"><code>RepertoireMetrics.SimpsonDiversity</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>SimpsonDiversity: 1 - D (Gini-Simpson index)</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.InverseSimpson"><a class="docstring-binding" href="#RepertoireMetrics.InverseSimpson"><code>RepertoireMetrics.InverseSimpson</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>InverseSimpson: 1/D - effective number of lineages (Hill q=2)</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.BergerParker"><a class="docstring-binding" href="#RepertoireMetrics.BergerParker"><code>RepertoireMetrics.BergerParker</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>BergerParker: Proportion of most abundant lineage</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.Evenness"><a class="docstring-binding" href="#RepertoireMetrics.Evenness"><code>RepertoireMetrics.Evenness</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Evenness: Pielou&#39;s J = H / log(S)</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.Clonality"><a class="docstring-binding" href="#RepertoireMetrics.Clonality"><code>RepertoireMetrics.Clonality</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Clonality: 1 - normalized Shannon entropy</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.GiniCoefficient"><a class="docstring-binding" href="#RepertoireMetrics.GiniCoefficient"><code>RepertoireMetrics.GiniCoefficient</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>GiniCoefficient: Inequality measure [0,1]</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.D50"><a class="docstring-binding" href="#RepertoireMetrics.D50"><code>RepertoireMetrics.D50</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>D50: Minimum lineages comprising 50% of repertoire</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.Chao1"><a class="docstring-binding" href="#RepertoireMetrics.Chao1"><code>RepertoireMetrics.Chao1</code></a> — <span class="docstring-category">Type</span></summary><section><div><p>Chao1: Richness estimator including unobserved species</p></div></section></details></article><h2 id="Sampling"><a class="docs-heading-anchor" href="#Sampling">Sampling</a><a id="Sampling-1"></a><a class="docs-heading-anchor-permalink" href="#Sampling" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="RepertoireMetrics.rarefaction"><a class="docstring-binding" href="#RepertoireMetrics.rarefaction"><code>RepertoireMetrics.rarefaction</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">rarefaction(rep::Repertoire, depth::Integer; rng=nothing) -&gt; Repertoire</code></pre><p>Randomly subsample a repertoire to a specified depth (total count).</p><p>Many diversity metrics are sensitive to sample size—deeper sequencing captures more  rare lineages. Rarefaction normalizes sample sizes by randomly subsampling all  repertoires to the same depth, enabling fair comparisons.</p><p><strong>Arguments</strong></p><ul><li><code>rep</code>: Input repertoire</li><li><code>depth</code>: Target total count (must be ≤ current total count of <code>rep</code>)</li><li><code>rng</code>: Optional random number generator for reproducibility</li></ul><p><strong>Returns</strong></p><p>A new <code>Repertoire</code> with subsampled counts. Lineages that received zero counts  in the subsample are removed.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs"># Compare two repertoires of different sizes
rep1 = read_repertoire(&quot;donor1.tsv&quot;, VJCdr3Definition())  # 50,000 sequences
rep2 = read_repertoire(&quot;donor2.tsv&quot;, VJCdr3Definition())  # 12,000 sequences

# Rarefy to the smaller depth
target = min(total_count(rep1), total_count(rep2))
rep1_rare = rarefaction(rep1, target)
rep2_rare = rarefaction(rep2, target)

# Now compare fairly
compute_metrics(rep1_rare)
compute_metrics(rep2_rare)

# For reproducibility, use a fixed RNG
using Random
rng = MersenneTwister(42)
rarefied = rarefaction(rep, 10000; rng=rng)</code></pre><p><strong>Notes</strong></p><ul><li>Rarefaction is stochastic; results vary between runs unless <code>rng</code> is fixed</li><li>For robust estimates, consider averaging metrics over multiple rarefactions</li><li>Metrics like Simpson index are naturally less sensitive to sample size</li></ul></div></section></details></article><h2 id="Exporting-Results"><a class="docs-heading-anchor" href="#Exporting-Results">Exporting Results</a><a id="Exporting-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Exporting-Results" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="RepertoireMetrics.metrics_to_dataframe"><a class="docstring-binding" href="#RepertoireMetrics.metrics_to_dataframe"><code>RepertoireMetrics.metrics_to_dataframe</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">metrics_to_dataframe(m::Metrics, donor_id::String=&quot;&quot;) -&gt; DataFrame</code></pre><p>Convert Metrics to a single-row DataFrame.</p></div></section><section><div><pre><code class="language-julia hljs">metrics_to_dataframe(collection::RepertoireCollection, metrics::Vector{Metrics}) -&gt; DataFrame</code></pre><p>Convert a collection&#39;s metrics to a DataFrame with one row per donor.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.write_metrics"><a class="docstring-binding" href="#RepertoireMetrics.write_metrics"><code>RepertoireMetrics.write_metrics</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">write_metrics(filepath::AbstractString, df::DataFrame; kwargs...)</code></pre><p>Write metrics DataFrame to a TSV file.</p></div></section></details></article><h2 id="Length-Statistics"><a class="docs-heading-anchor" href="#Length-Statistics">Length Statistics</a><a id="Length-Statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Length-Statistics" title="Permalink"></a></h2><h3 id="Types-and-Functions"><a class="docs-heading-anchor" href="#Types-and-Functions">Types and Functions</a><a id="Types-and-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Types-and-Functions" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="RepertoireMetrics.LengthStats"><a class="docstring-binding" href="#RepertoireMetrics.LengthStats"><code>RepertoireMetrics.LengthStats</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">LengthStats</code></pre><p>Container for sequence length statistics, stored in Repertoire metadata.</p><p><strong>Fields</strong></p><ul><li><code>mean_length::Float64</code>: Mean sequence length</li><li><code>median_length::Float64</code>: Median sequence length  </li><li><code>std_length::Float64</code>: Standard deviation of sequence length</li><li><code>min_length::Int</code>: Minimum sequence length</li><li><code>max_length::Int</code>: Maximum sequence length</li><li><code>n_sequences::Int</code>: Number of sequences analyzed</li><li><code>column::Symbol</code>: Column used for length calculation</li><li><code>use_aa::Bool</code>: Whether lengths are in amino acids</li></ul><p>Computed during repertoire construction when a <code>length_column</code> is specified.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.compute_length_stats"><a class="docstring-binding" href="#RepertoireMetrics.compute_length_stats"><code>RepertoireMetrics.compute_length_stats</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">compute_length_stats(sl::SequenceLengths) -&gt; LengthStats</code></pre><p>Compute length statistics from extracted sequence lengths.</p></div></section><section><div><pre><code class="language-julia hljs">compute_length_stats(df::DataFrame; length_column=:cdr3, count_column=nothing, use_aa=false) -&gt; LengthStats</code></pre><p>Compute length statistics from a DataFrame column.</p><p><strong>Arguments</strong></p><ul><li><code>df</code>: DataFrame containing sequences</li><li><code>length_column</code>: Column to measure length from (default <code>:cdr3</code>)</li><li><code>count_column</code>: If provided, weight statistics by this count column</li><li><code>use_aa</code>: If <code>true</code>, column contains amino acid sequences. If <code>false</code> (default), assumes nucleotide sequences and divides length by 3.</li></ul><p><strong>Returns</strong></p><p>A <code>LengthStats</code> object with computed statistics.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.length_distribution"><a class="docstring-binding" href="#RepertoireMetrics.length_distribution"><code>RepertoireMetrics.length_distribution</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">length_distribution(sl::SequenceLengths) -&gt; Dict{Int,Int}</code></pre><p>Compute length distribution from extracted sequence lengths.</p></div></section><section><div><pre><code class="language-julia hljs">length_distribution(df::DataFrame; length_column=:cdr3, count_column=nothing, use_aa=false) -&gt; Dict{Int,Int}</code></pre><p>Compute the distribution of sequence lengths.</p><p><strong>Arguments</strong></p><ul><li><code>df</code>: DataFrame containing sequences</li><li><code>length_column</code>: Column to measure length from (default <code>:cdr3</code>)</li><li><code>count_column</code>: If provided, weight by this count column</li><li><code>use_aa</code>: If <code>true</code>, column contains amino acid sequences</li></ul><p><strong>Returns</strong></p><p>A <code>Dict{Int,Int}</code> mapping length to count.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">dist = length_distribution(df; length_column=:cdr3)
for (len, cnt) in sort(collect(dist))
    println(&quot;Length $len: $cnt sequences&quot;)
end</code></pre></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.has_length_stats"><a class="docstring-binding" href="#RepertoireMetrics.has_length_stats"><code>RepertoireMetrics.has_length_stats</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">has_length_stats(rep::Repertoire) -&gt; Bool</code></pre><p>Check if length statistics are available for this repertoire.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.length_stats"><a class="docstring-binding" href="#RepertoireMetrics.length_stats"><code>RepertoireMetrics.length_stats</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">length_stats(rep::Repertoire) -&gt; LengthStats</code></pre><p>Return the LengthStats object for this repertoire.</p></div></section></details></article><h3 id="Composable-Length-Metrics"><a class="docs-heading-anchor" href="#Composable-Length-Metrics">Composable Length Metrics</a><a id="Composable-Length-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Composable-Length-Metrics" title="Permalink"></a></h3><article><details class="docstring" open="true"><summary id="RepertoireMetrics.MeanLength"><a class="docstring-binding" href="#RepertoireMetrics.MeanLength"><code>RepertoireMetrics.MeanLength</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">MeanLength &lt;: AbstractMetric</code></pre><p>Metric type for mean sequence length. Requires <code>length_column</code> to be specified during repertoire construction.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.MedianLength"><a class="docstring-binding" href="#RepertoireMetrics.MedianLength"><code>RepertoireMetrics.MedianLength</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">MedianLength &lt;: AbstractMetric</code></pre><p>Metric type for median sequence length.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.StdLength"><a class="docstring-binding" href="#RepertoireMetrics.StdLength"><code>RepertoireMetrics.StdLength</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">StdLength &lt;: AbstractMetric</code></pre><p>Metric type for standard deviation of sequence length.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.MinLength"><a class="docstring-binding" href="#RepertoireMetrics.MinLength"><code>RepertoireMetrics.MinLength</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">MinLength &lt;: AbstractMetric</code></pre><p>Metric type for minimum sequence length.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.MaxLength"><a class="docstring-binding" href="#RepertoireMetrics.MaxLength"><code>RepertoireMetrics.MaxLength</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">MaxLength &lt;: AbstractMetric</code></pre><p>Metric type for maximum sequence length.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.mean_length"><a class="docstring-binding" href="#RepertoireMetrics.mean_length"><code>RepertoireMetrics.mean_length</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">mean_length(rep::Repertoire) -&gt; Float64</code></pre><p>Return the mean sequence length. Requires length statistics to be computed during repertoire construction (via <code>length_column</code> parameter).</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.median_length"><a class="docstring-binding" href="#RepertoireMetrics.median_length"><code>RepertoireMetrics.median_length</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">median_length(rep::Repertoire) -&gt; Float64</code></pre><p>Return the median sequence length.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.std_length"><a class="docstring-binding" href="#RepertoireMetrics.std_length"><code>RepertoireMetrics.std_length</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">std_length(rep::Repertoire) -&gt; Float64</code></pre><p>Return the standard deviation of sequence length.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.min_length"><a class="docstring-binding" href="#RepertoireMetrics.min_length"><code>RepertoireMetrics.min_length</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">min_length(rep::Repertoire) -&gt; Int</code></pre><p>Return the minimum sequence length.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.max_length"><a class="docstring-binding" href="#RepertoireMetrics.max_length"><code>RepertoireMetrics.max_length</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">max_length(rep::Repertoire) -&gt; Int</code></pre><p>Return the maximum sequence length.</p></div></section></details></article><article><details class="docstring" open="true"><summary id="RepertoireMetrics.LENGTH_METRICS"><a class="docstring-binding" href="#RepertoireMetrics.LENGTH_METRICS"><code>RepertoireMetrics.LENGTH_METRICS</code></a> — <span class="docstring-category">Constant</span></summary><section><div><pre><code class="language-julia hljs">LENGTH_METRICS</code></pre><p>Predefined MetricSet containing all length metrics: <code>MeanLength() + MedianLength() + StdLength() + MinLength() + MaxLength()</code></p></div></section></details></article><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#RepertoireMetrics.ALL_METRICS"><code>RepertoireMetrics.ALL_METRICS</code></a></li><li><a href="#RepertoireMetrics.CLONALITY_METRICS"><code>RepertoireMetrics.CLONALITY_METRICS</code></a></li><li><a href="#RepertoireMetrics.DIVERSITY_METRICS"><code>RepertoireMetrics.DIVERSITY_METRICS</code></a></li><li><a href="#RepertoireMetrics.LENGTH_METRICS"><code>RepertoireMetrics.LENGTH_METRICS</code></a></li><li><a href="#RepertoireMetrics.RICHNESS_METRICS"><code>RepertoireMetrics.RICHNESS_METRICS</code></a></li><li><a href="#RepertoireMetrics.ROBUST_METRICS"><code>RepertoireMetrics.ROBUST_METRICS</code></a></li><li><a href="#RepertoireMetrics.AbstractLineageDefinition"><code>RepertoireMetrics.AbstractLineageDefinition</code></a></li><li><a href="#RepertoireMetrics.AbstractMetric"><code>RepertoireMetrics.AbstractMetric</code></a></li><li><a href="#RepertoireMetrics.BergerParker"><code>RepertoireMetrics.BergerParker</code></a></li><li><a href="#RepertoireMetrics.Chao1"><code>RepertoireMetrics.Chao1</code></a></li><li><a href="#RepertoireMetrics.Clonality"><code>RepertoireMetrics.Clonality</code></a></li><li><a href="#RepertoireMetrics.CustomDefinition"><code>RepertoireMetrics.CustomDefinition</code></a></li><li><a href="#RepertoireMetrics.D50"><code>RepertoireMetrics.D50</code></a></li><li><a href="#RepertoireMetrics.Depth"><code>RepertoireMetrics.Depth</code></a></li><li><a href="#RepertoireMetrics.Evenness"><code>RepertoireMetrics.Evenness</code></a></li><li><a href="#RepertoireMetrics.GiniCoefficient"><code>RepertoireMetrics.GiniCoefficient</code></a></li><li><a href="#RepertoireMetrics.HillNumber"><code>RepertoireMetrics.HillNumber</code></a></li><li><a href="#RepertoireMetrics.InverseSimpson"><code>RepertoireMetrics.InverseSimpson</code></a></li><li><a href="#RepertoireMetrics.LengthStats"><code>RepertoireMetrics.LengthStats</code></a></li><li><a href="#RepertoireMetrics.LineageIDDefinition"><code>RepertoireMetrics.LineageIDDefinition</code></a></li><li><a href="#RepertoireMetrics.MaxLength"><code>RepertoireMetrics.MaxLength</code></a></li><li><a href="#RepertoireMetrics.MeanLength"><code>RepertoireMetrics.MeanLength</code></a></li><li><a href="#RepertoireMetrics.MedianLength"><code>RepertoireMetrics.MedianLength</code></a></li><li><a href="#RepertoireMetrics.MetricSet"><code>RepertoireMetrics.MetricSet</code></a></li><li><a href="#RepertoireMetrics.Metrics"><code>RepertoireMetrics.Metrics</code></a></li><li><a href="#RepertoireMetrics.MinLength"><code>RepertoireMetrics.MinLength</code></a></li><li><a href="#RepertoireMetrics.NormalizedShannon"><code>RepertoireMetrics.NormalizedShannon</code></a></li><li><a href="#RepertoireMetrics.Repertoire"><code>RepertoireMetrics.Repertoire</code></a></li><li><a href="#RepertoireMetrics.RepertoireCollection"><code>RepertoireMetrics.RepertoireCollection</code></a></li><li><a href="#RepertoireMetrics.Richness"><code>RepertoireMetrics.Richness</code></a></li><li><a href="#RepertoireMetrics.ShannonDiversity"><code>RepertoireMetrics.ShannonDiversity</code></a></li><li><a href="#RepertoireMetrics.ShannonEntropy"><code>RepertoireMetrics.ShannonEntropy</code></a></li><li><a href="#RepertoireMetrics.SimpsonDiversity"><code>RepertoireMetrics.SimpsonDiversity</code></a></li><li><a href="#RepertoireMetrics.SimpsonIndex"><code>RepertoireMetrics.SimpsonIndex</code></a></li><li><a href="#RepertoireMetrics.StdLength"><code>RepertoireMetrics.StdLength</code></a></li><li><a href="#RepertoireMetrics.TotalCount"><code>RepertoireMetrics.TotalCount</code></a></li><li><a href="#RepertoireMetrics.VJCdr3Definition"><code>RepertoireMetrics.VJCdr3Definition</code></a></li><li><a href="#RepertoireMetrics.berger_parker_index"><code>RepertoireMetrics.berger_parker_index</code></a></li><li><a href="#RepertoireMetrics.chao1"><code>RepertoireMetrics.chao1</code></a></li><li><a href="#RepertoireMetrics.clonality"><code>RepertoireMetrics.clonality</code></a></li><li><a href="#RepertoireMetrics.compute_length_stats"><code>RepertoireMetrics.compute_length_stats</code></a></li><li><a href="#RepertoireMetrics.compute_metric"><code>RepertoireMetrics.compute_metric</code></a></li><li><a href="#RepertoireMetrics.compute_metrics"><code>RepertoireMetrics.compute_metrics</code></a></li><li><a href="#RepertoireMetrics.counts"><code>RepertoireMetrics.counts</code></a></li><li><a href="#RepertoireMetrics.d50"><code>RepertoireMetrics.d50</code></a></li><li><a href="#RepertoireMetrics.donor_id"><code>RepertoireMetrics.donor_id</code></a></li><li><a href="#RepertoireMetrics.evenness"><code>RepertoireMetrics.evenness</code></a></li><li><a href="#RepertoireMetrics.first_allele"><code>RepertoireMetrics.first_allele</code></a></li><li><a href="#RepertoireMetrics.frequencies"><code>RepertoireMetrics.frequencies</code></a></li><li><a href="#RepertoireMetrics.gini_coefficient"><code>RepertoireMetrics.gini_coefficient</code></a></li><li><a href="#RepertoireMetrics.has_length_stats"><code>RepertoireMetrics.has_length_stats</code></a></li><li><a href="#RepertoireMetrics.hill_number"><code>RepertoireMetrics.hill_number</code></a></li><li><a href="#RepertoireMetrics.inverse_simpson"><code>RepertoireMetrics.inverse_simpson</code></a></li><li><a href="#RepertoireMetrics.length_distribution"><code>RepertoireMetrics.length_distribution</code></a></li><li><a href="#RepertoireMetrics.length_stats"><code>RepertoireMetrics.length_stats</code></a></li><li><a href="#RepertoireMetrics.lineage_ids"><code>RepertoireMetrics.lineage_ids</code></a></li><li><a href="#RepertoireMetrics.lineage_key"><code>RepertoireMetrics.lineage_key</code></a></li><li><a href="#RepertoireMetrics.max_length"><code>RepertoireMetrics.max_length</code></a></li><li><a href="#RepertoireMetrics.mean_length"><code>RepertoireMetrics.mean_length</code></a></li><li><a href="#RepertoireMetrics.median_length"><code>RepertoireMetrics.median_length</code></a></li><li><a href="#RepertoireMetrics.metrics_to_dataframe"><code>RepertoireMetrics.metrics_to_dataframe</code></a></li><li><a href="#RepertoireMetrics.min_length"><code>RepertoireMetrics.min_length</code></a></li><li><a href="#RepertoireMetrics.rarefaction"><code>RepertoireMetrics.rarefaction</code></a></li><li><a href="#RepertoireMetrics.read_repertoire"><code>RepertoireMetrics.read_repertoire</code></a></li><li><a href="#RepertoireMetrics.read_repertoires"><code>RepertoireMetrics.read_repertoires</code></a></li><li><a href="#RepertoireMetrics.read_repertoires_from_directory"><code>RepertoireMetrics.read_repertoires_from_directory</code></a></li><li><a href="#RepertoireMetrics.repertoire_from_dataframe"><code>RepertoireMetrics.repertoire_from_dataframe</code></a></li><li><a href="#RepertoireMetrics.richness"><code>RepertoireMetrics.richness</code></a></li><li><a href="#RepertoireMetrics.shannon_entropy"><code>RepertoireMetrics.shannon_entropy</code></a></li><li><a href="#RepertoireMetrics.simpson_diversity"><code>RepertoireMetrics.simpson_diversity</code></a></li><li><a href="#RepertoireMetrics.simpson_index"><code>RepertoireMetrics.simpson_index</code></a></li><li><a href="#RepertoireMetrics.split_by_donor"><code>RepertoireMetrics.split_by_donor</code></a></li><li><a href="#RepertoireMetrics.std_length"><code>RepertoireMetrics.std_length</code></a></li><li><a href="#RepertoireMetrics.total_count"><code>RepertoireMetrics.total_count</code></a></li><li><a href="#RepertoireMetrics.write_metrics"><code>RepertoireMetrics.write_metrics</code></a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../composable/">« Composable Metrics</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 29 January 2026 13:14">Thursday 29 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
