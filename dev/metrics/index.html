<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Metrics · RepertoireMetrics.jl</title><meta name="title" content="Metrics · RepertoireMetrics.jl"/><meta property="og:title" content="Metrics · RepertoireMetrics.jl"/><meta property="twitter:title" content="Metrics · RepertoireMetrics.jl"/><meta name="description" content="Documentation for RepertoireMetrics.jl."/><meta property="og:description" content="Documentation for RepertoireMetrics.jl."/><meta property="twitter:description" content="Documentation for RepertoireMetrics.jl."/><meta property="og:url" content="https://mashu.github.io/RepertoireMetrics.jl/metrics/"/><meta property="twitter:url" content="https://mashu.github.io/RepertoireMetrics.jl/metrics/"/><link rel="canonical" href="https://mashu.github.io/RepertoireMetrics.jl/metrics/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">RepertoireMetrics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../quickstart/">Quick Start</a></li><li class="is-active"><a class="tocitem" href>Metrics</a><ul class="internal"><li><a class="tocitem" href="#Quick-Reference:-Which-Metric-Should-I-Use?"><span>Quick Reference: Which Metric Should I Use?</span></a></li><li><a class="tocitem" href="#Notation"><span>Notation</span></a></li><li><a class="tocitem" href="#Basic-Counts"><span>Basic Counts</span></a></li><li><a class="tocitem" href="#Shannon-Entropy-Family"><span>Shannon Entropy Family</span></a></li><li><a class="tocitem" href="#Simpson-Family"><span>Simpson Family</span></a></li><li><a class="tocitem" href="#Dominance-Metrics"><span>Dominance Metrics</span></a></li><li><a class="tocitem" href="#Inequality-Metrics"><span>Inequality Metrics</span></a></li><li><a class="tocitem" href="#Richness-Estimators"><span>Richness Estimators</span></a></li><li><a class="tocitem" href="#Hill-Numbers-(Unified-Framework)"><span>Hill Numbers (Unified Framework)</span></a></li><li><a class="tocitem" href="#Comparing-Metrics"><span>Comparing Metrics</span></a></li><li><a class="tocitem" href="#Handling-Different-Sequencing-Depths"><span>Handling Different Sequencing Depths</span></a></li></ul></li><li><a class="tocitem" href="../composable/">Composable Metrics</a></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Metrics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Metrics</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Diversity-and-Clonality-Metrics"><a class="docs-heading-anchor" href="#Diversity-and-Clonality-Metrics">Diversity and Clonality Metrics</a><a id="Diversity-and-Clonality-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Diversity-and-Clonality-Metrics" title="Permalink"></a></h1><p>This page provides detailed explanations of all metrics implemented in RepertoireMetrics.jl, including mathematical formulas, interpretation, and usage guidelines.</p><h2 id="Quick-Reference:-Which-Metric-Should-I-Use?"><a class="docs-heading-anchor" href="#Quick-Reference:-Which-Metric-Should-I-Use?">Quick Reference: Which Metric Should I Use?</a><a id="Quick-Reference:-Which-Metric-Should-I-Use?-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Reference:-Which-Metric-Should-I-Use?" title="Permalink"></a></h2><table><tr><th style="text-align: right">Your Question</th><th style="text-align: right">Recommended Metrics</th><th style="text-align: right">Why</th></tr><tr><td style="text-align: right">How many unique clones?</td><td style="text-align: right"><code>Richness</code>, <code>Chao1</code></td><td style="text-align: right">Chao1 estimates unseen clones</td></tr><tr><td style="text-align: right">Is the repertoire clonally expanded?</td><td style="text-align: right"><code>Clonality</code>, <code>Gini</code>, <code>D50</code></td><td style="text-align: right">Directly measure dominance</td></tr><tr><td style="text-align: right">How diverse overall?</td><td style="text-align: right"><code>Shannon Diversity</code>, <code>Inverse Simpson</code></td><td style="text-align: right">Effective number of clones</td></tr><tr><td style="text-align: right">How dominant is the top clone?</td><td style="text-align: right"><code>Berger-Parker</code>, <code>D50</code></td><td style="text-align: right">Simple, interpretable</td></tr><tr><td style="text-align: right">Comparing samples of different sizes?</td><td style="text-align: right"><code>Simpson</code>, <code>Berger-Parker</code>, <code>Gini</code></td><td style="text-align: right">Frequency-based, depth-robust</td></tr><tr><td style="text-align: right">Need richness comparison across depths?</td><td style="text-align: right"><code>rarefaction</code> + <code>Richness</code></td><td style="text-align: right">Rarefaction equalizes depth</td></tr><tr><td style="text-align: right">Full diversity profile?</td><td style="text-align: right"><code>Hill numbers</code> with varying q</td><td style="text-align: right">Unified theoretical framework</td></tr></table><h3 id="Common-Pitfalls"><a class="docs-heading-anchor" href="#Common-Pitfalls">Common Pitfalls</a><a id="Common-Pitfalls-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Pitfalls" title="Permalink"></a></h3><table><tr><th style="text-align: right">Pitfall</th><th style="text-align: right">Problem</th><th style="text-align: right">Solution</th></tr><tr><td style="text-align: right">Comparing richness across sample sizes</td><td style="text-align: right">Larger samples always show more clones</td><td style="text-align: right">Use rarefaction or Chao1</td></tr><tr><td style="text-align: right">Ignoring rare clones</td><td style="text-align: right">Simpson/Berger-Parker may miss important rare populations</td><td style="text-align: right">Also compute Shannon or richness</td></tr><tr><td style="text-align: right">Over-interpreting small differences</td><td style="text-align: right">Sampling noise can be substantial</td><td style="text-align: right">Use confidence intervals or bootstrapping</td></tr><tr><td style="text-align: right">Assuming one metric tells the whole story</td><td style="text-align: right">Different metrics capture different aspects</td><td style="text-align: right">Report multiple complementary metrics</td></tr></table><h3 id="Metric-Relationships"><a class="docs-heading-anchor" href="#Metric-Relationships">Metric Relationships</a><a id="Metric-Relationships-1"></a><a class="docs-heading-anchor-permalink" href="#Metric-Relationships" title="Permalink"></a></h3><pre><code class="nohighlight hljs">Clonality = 1 - Evenness = 1 - (Shannon Entropy / log(Richness))
Shannon Diversity = exp(Shannon Entropy) = Hill number q=1
Inverse Simpson = 1 / Simpson Index = Hill number q=2</code></pre><hr/><h2 id="Notation"><a class="docs-heading-anchor" href="#Notation">Notation</a><a id="Notation-1"></a><a class="docs-heading-anchor-permalink" href="#Notation" title="Permalink"></a></h2><p>Throughout this document:</p><ul><li><span>$S$</span> = number of unique lineages (richness)</li><li><span>$N$</span> = total count (sequences or cells)</li><li><span>$n_i$</span> = count of lineage <span>$i$</span></li><li><span>$p_i = n_i / N$</span> = relative frequency of lineage <span>$i$</span></li><li><span>$f_k$</span> = number of lineages with exactly <span>$k$</span> sequences (frequency of frequencies)</li></ul><h2 id="Basic-Counts"><a class="docs-heading-anchor" href="#Basic-Counts">Basic Counts</a><a id="Basic-Counts-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Counts" title="Permalink"></a></h2><h3 id="Richness-(S)"><a class="docs-heading-anchor" href="#Richness-(S)">Richness (S)</a><a id="Richness-(S)-1"></a><a class="docs-heading-anchor-permalink" href="#Richness-(S)" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[S = \sum_{i=1}^{S} \mathbf{1}[n_i &gt; 0]\]</p><p><strong>Interpretation:</strong> The total number of unique lineages observed in the repertoire. This is the simplest measure of diversity—more lineages means more diverse.</p><p><strong>Limitations:</strong> Richness is highly sensitive to sample size. Larger samples almost always have higher richness, making direct comparisons difficult without rarefaction.</p><p><strong>Use when:</strong> You want a basic count of unique clones, especially when comparing samples of similar size.</p><h3 id="Total-Count-(N)"><a class="docs-heading-anchor" href="#Total-Count-(N)">Total Count (N)</a><a id="Total-Count-(N)-1"></a><a class="docs-heading-anchor-permalink" href="#Total-Count-(N)" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[N = \sum_{i=1}^{S} n_i\]</p><p><strong>Interpretation:</strong> The total number of sequences or cells in the repertoire. Essential for normalization and understanding sampling depth.</p><hr/><h2 id="Shannon-Entropy-Family"><a class="docs-heading-anchor" href="#Shannon-Entropy-Family">Shannon Entropy Family</a><a id="Shannon-Entropy-Family-1"></a><a class="docs-heading-anchor-permalink" href="#Shannon-Entropy-Family" title="Permalink"></a></h2><h3 id="Shannon-Entropy-(H)"><a class="docs-heading-anchor" href="#Shannon-Entropy-(H)">Shannon Entropy (H)</a><a id="Shannon-Entropy-(H)-1"></a><a class="docs-heading-anchor-permalink" href="#Shannon-Entropy-(H)" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[H = -\sum_{i=1}^{S} p_i \log(p_i)\]</p><p>where we use the convention that <span>$0 \log(0) = 0$</span>.</p><p><strong>Interpretation:</strong> Shannon entropy quantifies the uncertainty in predicting the lineage of a randomly selected sequence. Higher entropy means more uncertainty, indicating a more diverse repertoire.</p><p><strong>Range:</strong> <span>$[0, \log(S)]$</span></p><ul><li><span>$H = 0$</span> when one lineage dominates completely</li><li><span>$H = \log(S)$</span> when all lineages are equally abundant</li></ul><p><strong>Properties:</strong></p><ul><li>Uses natural logarithm (nats), though log₂ (bits) is also common</li><li>Sensitive to rare lineages but less so than richness</li><li>Affected by both richness and evenness</li></ul><h3 id="Shannon-Diversity-(Exponential-of-H)"><a class="docs-heading-anchor" href="#Shannon-Diversity-(Exponential-of-H)">Shannon Diversity (Exponential of H)</a><a id="Shannon-Diversity-(Exponential-of-H)-1"></a><a class="docs-heading-anchor-permalink" href="#Shannon-Diversity-(Exponential-of-H)" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[{}^1D = e^H = \exp\left(-\sum_{i=1}^{S} p_i \log(p_i)\right)\]</p><p><strong>Interpretation:</strong> The &quot;effective number of lineages&quot;—how many equally abundant lineages would produce the same entropy. Also known as the Hill number of order 1.</p><p><strong>Range:</strong> <span>$[1, S]$</span></p><ul><li><span>${}^1D = 1$</span> for a single dominant lineage</li><li><span>${}^1D = S$</span> for perfect evenness</li></ul><p><strong>Why use this over raw entropy?</strong> Shannon diversity is in interpretable units (number of lineages) rather than abstract entropy units.</p><h3 id="Normalized-Shannon-Entropy"><a class="docs-heading-anchor" href="#Normalized-Shannon-Entropy">Normalized Shannon Entropy</a><a id="Normalized-Shannon-Entropy-1"></a><a class="docs-heading-anchor-permalink" href="#Normalized-Shannon-Entropy" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[H_{norm} = \frac{H}{\log(S)} = \frac{H}{H_{max}}\]</p><p><strong>Interpretation:</strong> Shannon entropy scaled to [0, 1]. Represents how close the distribution is to maximum entropy (perfect evenness).</p><p><strong>Range:</strong> <span>$[0, 1]$</span></p><ul><li><span>$H_{norm} = 0$</span> for a single dominant lineage</li><li><span>$H_{norm} = 1$</span> for perfect evenness</li></ul><h3 id="Clonality"><a class="docs-heading-anchor" href="#Clonality">Clonality</a><a id="Clonality-1"></a><a class="docs-heading-anchor-permalink" href="#Clonality" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[\text{Clonality} = 1 - H_{norm} = 1 - \frac{H}{\log(S)}\]</p><p><strong>Interpretation:</strong> The complement of normalized Shannon entropy. High clonality indicates oligoclonal expansion—a repertoire dominated by few lineages.</p><p><strong>Range:</strong> <span>$[0, 1]$</span></p><ul><li><span>$\text{Clonality} = 0$</span> for perfect evenness (maximally polyclonal)</li><li><span>$\text{Clonality} = 1$</span> for a single lineage (monoclonal)</li></ul><p><strong>Use when:</strong> Investigating antigen-driven clonal expansion, disease states, or immune responses.</p><h3 id="Evenness-(Pielou&#39;s-J)"><a class="docs-heading-anchor" href="#Evenness-(Pielou&#39;s-J)">Evenness (Pielou&#39;s J)</a><a id="Evenness-(Pielou&#39;s-J)-1"></a><a class="docs-heading-anchor-permalink" href="#Evenness-(Pielou&#39;s-J)" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[J = \frac{H}{\log(S)} = H_{norm}\]</p><p><strong>Interpretation:</strong> Identical to normalized Shannon entropy. Measures how evenly sequences are distributed among lineages, independent of richness.</p><p><strong>Range:</strong> <span>$[0, 1]$</span></p><ul><li><span>$J = 0$</span> for maximum unevenness</li><li><span>$J = 1$</span> for perfect evenness</li></ul><p><strong>Note:</strong> Evenness = 1 - Clonality.</p><hr/><h2 id="Simpson-Family"><a class="docs-heading-anchor" href="#Simpson-Family">Simpson Family</a><a id="Simpson-Family-1"></a><a class="docs-heading-anchor-permalink" href="#Simpson-Family" title="Permalink"></a></h2><h3 id="Simpson&#39;s-Index-(D)"><a class="docs-heading-anchor" href="#Simpson&#39;s-Index-(D)">Simpson&#39;s Index (D)</a><a id="Simpson&#39;s-Index-(D)-1"></a><a class="docs-heading-anchor-permalink" href="#Simpson&#39;s-Index-(D)" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[D = \sum_{i=1}^{S} p_i^2\]</p><p><strong>Interpretation:</strong> The probability that two randomly selected sequences belong to the same lineage. Higher D means less diversity (more concentrated).</p><p><strong>Range:</strong> <span>$[1/S, 1]$</span></p><ul><li><span>$D = 1/S$</span> for perfect evenness</li><li><span>$D = 1$</span> for a single lineage</li></ul><p><strong>Note:</strong> This is sometimes called Simpson&#39;s concentration index.</p><h3 id="Simpson&#39;s-Diversity-(Gini-Simpson-Index)"><a class="docs-heading-anchor" href="#Simpson&#39;s-Diversity-(Gini-Simpson-Index)">Simpson&#39;s Diversity (Gini-Simpson Index)</a><a id="Simpson&#39;s-Diversity-(Gini-Simpson-Index)-1"></a><a class="docs-heading-anchor-permalink" href="#Simpson&#39;s-Diversity-(Gini-Simpson-Index)" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[1 - D = 1 - \sum_{i=1}^{S} p_i^2\]</p><p><strong>Interpretation:</strong> The probability that two randomly selected sequences belong to <em>different</em> lineages. Higher values indicate more diversity.</p><p><strong>Range:</strong> <span>$[0, 1 - 1/S]$</span></p><ul><li><span>$1 - D \to 0$</span> as repertoire becomes monoclonal</li><li><span>$1 - D \to 1$</span> as repertoire becomes maximally diverse</li></ul><h3 id="Inverse-Simpson-(Hill-Number-q2)"><a class="docs-heading-anchor" href="#Inverse-Simpson-(Hill-Number-q2)">Inverse Simpson (Hill Number q=2)</a><a id="Inverse-Simpson-(Hill-Number-q2)-1"></a><a class="docs-heading-anchor-permalink" href="#Inverse-Simpson-(Hill-Number-q2)" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[{}^2D = \frac{1}{D} = \frac{1}{\sum_{i=1}^{S} p_i^2}\]</p><p><strong>Interpretation:</strong> The &quot;effective number of lineages&quot; when weighted by frequency squared. Emphasizes dominant lineages more than Shannon diversity.</p><p><strong>Range:</strong> <span>$[1, S]$</span></p><ul><li><span>${}^2D = 1$</span> for a single lineage</li><li><span>${}^2D = S$</span> for perfect evenness</li></ul><p><strong>Use when:</strong> You want a diversity measure less sensitive to rare lineages than Shannon entropy.</p><hr/><h2 id="Dominance-Metrics"><a class="docs-heading-anchor" href="#Dominance-Metrics">Dominance Metrics</a><a id="Dominance-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Dominance-Metrics" title="Permalink"></a></h2><h3 id="Berger-Parker-Index"><a class="docs-heading-anchor" href="#Berger-Parker-Index">Berger-Parker Index</a><a id="Berger-Parker-Index-1"></a><a class="docs-heading-anchor-permalink" href="#Berger-Parker-Index" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[d = p_{max} = \max_i(p_i)\]</p><p><strong>Interpretation:</strong> The relative frequency of the most abundant lineage. A simple measure of dominance.</p><p><strong>Range:</strong> <span>$[1/S, 1]$</span></p><ul><li><span>$d = 1/S$</span> for perfect evenness</li><li><span>$d = 1$</span> when one lineage has all sequences</li></ul><p><strong>Use when:</strong> You want a simple, interpretable measure of how dominant the top clone is.</p><h3 id="D50"><a class="docs-heading-anchor" href="#D50">D50</a><a id="D50-1"></a><a class="docs-heading-anchor-permalink" href="#D50" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[D50 = \min\left\{k : \sum_{i=1}^{k} p_{(i)} \geq 0.5\right\}\]</p><p>where <span>$p_{(1)} \geq p_{(2)} \geq \cdots$</span> are frequencies sorted in descending order.</p><p><strong>Interpretation:</strong> The minimum number of lineages needed to account for 50% of the repertoire. Low D50 indicates high clonality (few lineages dominate).</p><p><strong>Range:</strong> <span>$[1, \lceil S/2 \rceil]$</span></p><ul><li><span>$D50 = 1$</span> when the top lineage has ≥50% of sequences</li><li><span>$D50 = \lceil S/2 \rceil$</span> for perfect evenness</li></ul><p><strong>Use when:</strong> You want an intuitive measure of how &quot;top-heavy&quot; the distribution is.</p><hr/><h2 id="Inequality-Metrics"><a class="docs-heading-anchor" href="#Inequality-Metrics">Inequality Metrics</a><a id="Inequality-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Inequality-Metrics" title="Permalink"></a></h2><h3 id="Gini-Coefficient"><a class="docs-heading-anchor" href="#Gini-Coefficient">Gini Coefficient</a><a id="Gini-Coefficient-1"></a><a class="docs-heading-anchor-permalink" href="#Gini-Coefficient" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[G = \frac{\sum_{i=1}^{S} \sum_{j=1}^{S} |p_i - p_j|}{2S \sum_{i=1}^{S} p_i} = \frac{2\sum_{i=1}^{S} i \cdot p_{(i)}}{S} - \frac{S+1}{S}\]</p><p>where <span>$p_{(1)} \leq p_{(2)} \leq \cdots$</span> are frequencies sorted in ascending order.</p><p><strong>Interpretation:</strong> Measures inequality in lineage abundances. Originally developed for economic inequality (wealth distribution).</p><p><strong>Range:</strong> <span>$[0, 1]$</span></p><ul><li><span>$G = 0$</span> for perfect equality (all lineages equal)</li><li><span>$G \to 1$</span> for maximum inequality</li></ul><p><strong>Geometric interpretation:</strong> Half the relative mean absolute difference between all pairs of lineages.</p><p><strong>Use when:</strong> You want to quantify how unequally sequences are distributed, independent of richness.</p><hr/><h2 id="Richness-Estimators"><a class="docs-heading-anchor" href="#Richness-Estimators">Richness Estimators</a><a id="Richness-Estimators-1"></a><a class="docs-heading-anchor-permalink" href="#Richness-Estimators" title="Permalink"></a></h2><h3 id="Chao1"><a class="docs-heading-anchor" href="#Chao1">Chao1</a><a id="Chao1-1"></a><a class="docs-heading-anchor-permalink" href="#Chao1" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[\hat{S}_{Chao1} = S_{obs} + \frac{f_1^2}{2 f_2}\]</p><p>where:</p><ul><li><span>$S_{obs}$</span> = observed richness</li><li><span>$f_1$</span> = number of singletons (lineages with count = 1)</li><li><span>$f_2$</span> = number of doubletons (lineages with count = 2)</li></ul><p>If <span>$f_2 = 0$</span>, use the bias-corrected formula:</p><p class="math-container">\[\hat{S}_{Chao1} = S_{obs} + \frac{f_1(f_1 - 1)}{2}\]</p><p><strong>Interpretation:</strong> Estimates the true number of lineages, including those not observed due to sampling limitations. Based on the idea that rare species inform us about unobserved species.</p><p><strong>Range:</strong> <span>$[S_{obs}, \infty)$</span></p><p><strong>Use when:</strong> You suspect many rare lineages exist that weren&#39;t sampled, and want to estimate true richness.</p><hr/><h2 id="Hill-Numbers-(Unified-Framework)"><a class="docs-heading-anchor" href="#Hill-Numbers-(Unified-Framework)">Hill Numbers (Unified Framework)</a><a id="Hill-Numbers-(Unified-Framework)-1"></a><a class="docs-heading-anchor-permalink" href="#Hill-Numbers-(Unified-Framework)" title="Permalink"></a></h2><h3 id="Definition"><a class="docs-heading-anchor" href="#Definition">Definition</a><a id="Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Definition" title="Permalink"></a></h3><p><strong>Formula:</strong></p><p class="math-container">\[{}^qD = \left(\sum_{i=1}^{S} p_i^q\right)^{1/(1-q)}\]</p><p><strong>Special cases:</strong></p><table><tr><th style="text-align: right">Order</th><th style="text-align: right">Formula</th><th style="text-align: right">Interpretation</th></tr><tr><td style="text-align: right"><span>$q = 0$</span></td><td style="text-align: right"><span>${}^0D = S$</span></td><td style="text-align: right">Richness</td></tr><tr><td style="text-align: right"><span>$q \to 1$</span></td><td style="text-align: right"><span>${}^1D = e^H$</span></td><td style="text-align: right">exp(Shannon entropy)</td></tr><tr><td style="text-align: right"><span>$q = 2$</span></td><td style="text-align: right"><span>${}^2D = 1/D$</span></td><td style="text-align: right">Inverse Simpson</td></tr><tr><td style="text-align: right"><span>$q \to \infty$</span></td><td style="text-align: right"><span>${}^\infty D = 1/p_{max}$</span></td><td style="text-align: right">Reciprocal of Berger-Parker</td></tr></table><p><strong>Interpretation:</strong> Hill numbers provide a unified framework for diversity. The order <span>$q$</span> controls sensitivity to rare vs. common lineages:</p><ul><li>Low <span>$q$</span>: More sensitive to rare lineages</li><li>High <span>$q$</span>: More sensitive to dominant lineages</li></ul><p><strong>Use when:</strong> You want to explore the full diversity profile of a repertoire, or need a theoretically grounded framework that unifies different diversity measures.</p><hr/><h2 id="Comparing-Metrics"><a class="docs-heading-anchor" href="#Comparing-Metrics">Comparing Metrics</a><a id="Comparing-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Comparing-Metrics" title="Permalink"></a></h2><h3 id="Relationship-Between-Diversity-and-Clonality"><a class="docs-heading-anchor" href="#Relationship-Between-Diversity-and-Clonality">Relationship Between Diversity and Clonality</a><a id="Relationship-Between-Diversity-and-Clonality-1"></a><a class="docs-heading-anchor-permalink" href="#Relationship-Between-Diversity-and-Clonality" title="Permalink"></a></h3><table><tr><th style="text-align: right">Aspect</th><th style="text-align: right">Diversity Metrics</th><th style="text-align: right">Clonality Metrics</th></tr><tr><td style="text-align: right"><strong>Focus</strong></td><td style="text-align: right">Variability</td><td style="text-align: right">Dominance</td></tr><tr><td style="text-align: right"><strong>High value</strong></td><td style="text-align: right">Polyclonal</td><td style="text-align: right">Oligoclonal</td></tr><tr><td style="text-align: right"><strong>Examples</strong></td><td style="text-align: right">Shannon diversity, Inverse Simpson</td><td style="text-align: right">Clonality, Gini, D50 (inverse)</td></tr></table><p>Key relationships:</p><ul><li><code>Clonality = 1 - Evenness</code></li><li><code>Shannon Diversity = exp(Shannon Entropy)</code></li><li><code>Inverse Simpson = 1 / Simpson Index</code></li></ul><h3 id="Sensitivity-to-Different-Features"><a class="docs-heading-anchor" href="#Sensitivity-to-Different-Features">Sensitivity to Different Features</a><a id="Sensitivity-to-Different-Features-1"></a><a class="docs-heading-anchor-permalink" href="#Sensitivity-to-Different-Features" title="Permalink"></a></h3><table><tr><th style="text-align: right">Metric</th><th style="text-align: right">Sensitive to rare lineages</th><th style="text-align: right">Sensitive to dominant lineages</th><th style="text-align: right">Sensitive to sample size</th></tr><tr><td style="text-align: right">Richness</td><td style="text-align: right">Very high</td><td style="text-align: right">Low</td><td style="text-align: right">Very high</td></tr><tr><td style="text-align: right">Shannon Entropy</td><td style="text-align: right">Moderate</td><td style="text-align: right">Moderate</td><td style="text-align: right">Moderate</td></tr><tr><td style="text-align: right">Simpson Index</td><td style="text-align: right">Low</td><td style="text-align: right">High</td><td style="text-align: right">Low</td></tr><tr><td style="text-align: right">Berger-Parker</td><td style="text-align: right">Very low</td><td style="text-align: right">Very high</td><td style="text-align: right">Low</td></tr><tr><td style="text-align: right">Chao1</td><td style="text-align: right">Very high</td><td style="text-align: right">Low</td><td style="text-align: right">High</td></tr></table><h3 id="Recommendations"><a class="docs-heading-anchor" href="#Recommendations">Recommendations</a><a id="Recommendations-1"></a><a class="docs-heading-anchor-permalink" href="#Recommendations" title="Permalink"></a></h3><ol><li><p><strong>For detecting clonal expansion:</strong> Use Clonality, Gini, D50, or Berger-Parker.</p></li><li><p><strong>For a complete picture:</strong> Compute multiple metrics or use the Hill number profile across different orders.</p></li><li><p><strong>For estimating true diversity:</strong> Use Chao1, especially when many singletons are present.</p></li></ol><hr/><h2 id="Handling-Different-Sequencing-Depths"><a class="docs-heading-anchor" href="#Handling-Different-Sequencing-Depths">Handling Different Sequencing Depths</a><a id="Handling-Different-Sequencing-Depths-1"></a><a class="docs-heading-anchor-permalink" href="#Handling-Different-Sequencing-Depths" title="Permalink"></a></h2><p>When comparing repertoires with different total counts, you have several strategies:</p><h3 id="Strategy-1:-Use-Depth-Robust-Metrics-(Recommended)"><a class="docs-heading-anchor" href="#Strategy-1:-Use-Depth-Robust-Metrics-(Recommended)">Strategy 1: Use Depth-Robust Metrics (Recommended)</a><a id="Strategy-1:-Use-Depth-Robust-Metrics-(Recommended)-1"></a><a class="docs-heading-anchor-permalink" href="#Strategy-1:-Use-Depth-Robust-Metrics-(Recommended)" title="Permalink"></a></h3><p>Many metrics are computed from <strong>frequencies</strong> (proportions), not raw counts. Mathematically, these metrics depend only on the shape of the distribution, not the total N:</p><table><tr><th style="text-align: right">Metric</th><th style="text-align: right">Depth Sensitivity</th><th style="text-align: right">Why</th></tr><tr><td style="text-align: right">Simpson Index</td><td style="text-align: right"><strong>Low</strong></td><td style="text-align: right">Dominated by abundant clones</td></tr><tr><td style="text-align: right">Inverse Simpson</td><td style="text-align: right"><strong>Low</strong></td><td style="text-align: right">Same as Simpson</td></tr><tr><td style="text-align: right">Berger-Parker</td><td style="text-align: right"><strong>Very Low</strong></td><td style="text-align: right">Only looks at top clone</td></tr><tr><td style="text-align: right">Gini Coefficient</td><td style="text-align: right"><strong>Low</strong></td><td style="text-align: right">Measures inequality of frequencies</td></tr><tr><td style="text-align: right">Shannon Entropy</td><td style="text-align: right"><strong>Moderate</strong></td><td style="text-align: right">More sensitive to rare clones</td></tr><tr><td style="text-align: right">Richness</td><td style="text-align: right"><strong>Very High</strong></td><td style="text-align: right">More sequences = more rare clones observed</td></tr><tr><td style="text-align: right">Chao1</td><td style="text-align: right"><strong>High</strong></td><td style="text-align: right">Based on singletons/doubletons</td></tr></table><p><strong>When to use:</strong> When you have accurate count data and want to avoid information loss.</p><pre><code class="language-julia hljs"># Use the predefined ROBUST_METRICS set (includes Depth for reporting)
metrics = compute_metrics(rep, ROBUST_METRICS)

# Or select specific robust metrics
metrics = compute_metrics(rep, Depth() + SimpsonDiversity() + Clonality() + GiniCoefficient())</code></pre><p><strong>Always report depth:</strong> Include <code>Depth()</code> in your metrics so readers know the sequencing depth of each sample.</p><h3 id="Strategy-2:-Rarefaction-(Conservative)"><a class="docs-heading-anchor" href="#Strategy-2:-Rarefaction-(Conservative)">Strategy 2: Rarefaction (Conservative)</a><a id="Strategy-2:-Rarefaction-(Conservative)-1"></a><a class="docs-heading-anchor-permalink" href="#Strategy-2:-Rarefaction-(Conservative)" title="Permalink"></a></h3><p>Randomly subsample all repertoires to the same depth. See <a href="../quickstart/#Rarefaction-for-Comparing-Uneven-Samples">Rarefaction</a>.</p><p><strong>Pros:</strong> Makes richness comparable; theoretically rigorous   <strong>Cons:</strong> Discards information from deeper samples; introduces stochasticity</p><p><strong>When to use:</strong> When comparing richness specifically, or when you want the most conservative comparison.</p><h3 id="Strategy-3:-Normalize-to-Total-Count"><a class="docs-heading-anchor" href="#Strategy-3:-Normalize-to-Total-Count">Strategy 3: Normalize to Total Count</a><a id="Strategy-3:-Normalize-to-Total-Count-1"></a><a class="docs-heading-anchor-permalink" href="#Strategy-3:-Normalize-to-Total-Count" title="Permalink"></a></h3><p>If you have the <code>count</code> column, the total count reflects the original sequencing depth:</p><pre><code class="language-julia hljs">rep = read_repertoire(&quot;data.tsv&quot;, VJCdr3Definition())
println(&quot;Total sequences: &quot;, total_count(rep))  # Original depth preserved
println(&quot;Unique lineages: &quot;, richness(rep))     # Observed clones

# Frequencies are already normalized
freqs = frequencies(rep)  # Sum to 1.0</code></pre><p>The frequency-based metrics already use this normalization internally.</p><h3 id="Strategy-4:-Report-Depth-Alongside-Metrics"><a class="docs-heading-anchor" href="#Strategy-4:-Report-Depth-Alongside-Metrics">Strategy 4: Report Depth Alongside Metrics</a><a id="Strategy-4:-Report-Depth-Alongside-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Strategy-4:-Report-Depth-Alongside-Metrics" title="Permalink"></a></h3><p>Always report sequencing depth so readers can assess comparability:</p><pre><code class="language-julia hljs">metrics = compute_metrics(rep)
df = metrics_to_dataframe(rep, metrics)
# DataFrame includes total_count for context</code></pre><h3 id="The-Sampling-Reality"><a class="docs-heading-anchor" href="#The-Sampling-Reality">The Sampling Reality</a><a id="The-Sampling-Reality-1"></a><a class="docs-heading-anchor-permalink" href="#The-Sampling-Reality" title="Permalink"></a></h3><p>Even with &quot;depth-robust&quot; metrics, there&#39;s a subtlety: <strong>observed frequencies are estimates of true population frequencies</strong>. With shallow sequencing:</p><ul><li>Rare clones may not be observed at all</li><li>Observed frequencies of rare clones have higher variance</li></ul><p>This means Simpson/Shannon computed from shallow data may still differ from deep data, not because the metric is biased, but because the <em>input frequencies</em> are different estimates of the same underlying distribution.</p><p><strong>Bottom line:</strong> For robust comparisons, prefer Simpson-family metrics and report total counts. Use rarefaction when richness comparison is essential.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../quickstart/">« Quick Start</a><a class="docs-footer-nextpage" href="../composable/">Composable Metrics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 29 January 2026 15:12">Thursday 29 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
