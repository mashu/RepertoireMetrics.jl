<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quick Start · RepertoireMetrics.jl</title><meta name="title" content="Quick Start · RepertoireMetrics.jl"/><meta property="og:title" content="Quick Start · RepertoireMetrics.jl"/><meta property="twitter:title" content="Quick Start · RepertoireMetrics.jl"/><meta name="description" content="Documentation for RepertoireMetrics.jl."/><meta property="og:description" content="Documentation for RepertoireMetrics.jl."/><meta property="twitter:description" content="Documentation for RepertoireMetrics.jl."/><meta property="og:url" content="https://mashu.github.io/RepertoireMetrics.jl/quickstart/"/><meta property="twitter:url" content="https://mashu.github.io/RepertoireMetrics.jl/quickstart/"/><link rel="canonical" href="https://mashu.github.io/RepertoireMetrics.jl/quickstart/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">RepertoireMetrics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Quick Start</a><ul class="internal"><li><a class="tocitem" href="#Reading-Repertoire-Data"><span>Reading Repertoire Data</span></a></li><li><a class="tocitem" href="#Computing-Metrics"><span>Computing Metrics</span></a></li><li><a class="tocitem" href="#Multi-Donor-Analysis"><span>Multi-Donor Analysis</span></a></li><li><a class="tocitem" href="#Custom-Lineage-Definition"><span>Custom Lineage Definition</span></a></li><li><a class="tocitem" href="#Hill-Numbers"><span>Hill Numbers</span></a></li><li><a class="tocitem" href="#Comparing-Samples-of-Different-Depths"><span>Comparing Samples of Different Depths</span></a></li><li><a class="tocitem" href="#Length-Metrics-(CDR3-and-more)"><span>Length Metrics (CDR3 and more)</span></a></li></ul></li><li><a class="tocitem" href="../metrics/">Metrics</a></li><li><a class="tocitem" href="../composable/">Composable Metrics</a></li><li><a class="tocitem" href="../api/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Quick Start</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Quick Start</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Quick-Start"><a class="docs-heading-anchor" href="#Quick-Start">Quick Start</a><a id="Quick-Start-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Start" title="Permalink"></a></h1><p>This guide covers the essential workflows for analyzing B cell repertoire diversity.</p><h2 id="Reading-Repertoire-Data"><a class="docs-heading-anchor" href="#Reading-Repertoire-Data">Reading Repertoire Data</a><a id="Reading-Repertoire-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-Repertoire-Data" title="Permalink"></a></h2><p>RepertoireMetrics.jl reads MIAIRR-formatted TSV files. You need to specify how lineages are defined.</p><h3 id="Using-lineage_id-Column"><a class="docs-heading-anchor" href="#Using-lineage_id-Column">Using <code>lineage_id</code> Column</a><a id="Using-lineage_id-Column-1"></a><a class="docs-heading-anchor-permalink" href="#Using-lineage_id-Column" title="Permalink"></a></h3><p>If your data has been pre-processed with lineage assignment (e.g., by LineageCollapse.jl):</p><pre><code class="language-julia hljs">using RepertoireMetrics

rep = read_repertoire(&quot;collapsed_data.tsv&quot;, LineageIDDefinition())</code></pre><h3 id="Using-V-J-CDR3-Combination"><a class="docs-heading-anchor" href="#Using-V-J-CDR3-Combination">Using V-J-CDR3 Combination</a><a id="Using-V-J-CDR3-Combination-1"></a><a class="docs-heading-anchor-permalink" href="#Using-V-J-CDR3-Combination" title="Permalink"></a></h3><p>Define lineages by V gene, J gene, and CDR3 sequence (compatible with LineageCollapse.jl&#39;s default behavior):</p><pre><code class="language-julia hljs">rep = read_repertoire(&quot;sequences.tsv&quot;, VJCdr3Definition())</code></pre><p>The <code>VJCdr3Definition</code> automatically uses the first allele from gene calls. You can customize this:</p><pre><code class="language-julia hljs"># Use full gene call (with all alleles)
rep = read_repertoire(&quot;data.tsv&quot;, VJCdr3Definition(use_first_allele=false))

# Use different column names
strategy = VJCdr3Definition(
    v_column = :v_gene,
    j_column = :j_gene,
    cdr3_column = :cdr3_aa
)</code></pre><h3 id="Handling-Counts"><a class="docs-heading-anchor" href="#Handling-Counts">Handling Counts</a><a id="Handling-Counts-1"></a><a class="docs-heading-anchor-permalink" href="#Handling-Counts" title="Permalink"></a></h3><p>By default, the package looks for a <code>count</code> column. If not present, each row is counted as 1:</p><pre><code class="language-julia hljs"># Explicit: use count column
rep = read_repertoire(&quot;data.tsv&quot;, VJCdr3Definition(); count_column=:count)

# Each row = 1 sequence
rep = read_repertoire(&quot;data.tsv&quot;, VJCdr3Definition(); count_column=nothing)</code></pre><h2 id="Computing-Metrics"><a class="docs-heading-anchor" href="#Computing-Metrics">Computing Metrics</a><a id="Computing-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-Metrics" title="Permalink"></a></h2><h3 id="All-Metrics-(Default)"><a class="docs-heading-anchor" href="#All-Metrics-(Default)">All Metrics (Default)</a><a id="All-Metrics-(Default)-1"></a><a class="docs-heading-anchor-permalink" href="#All-Metrics-(Default)" title="Permalink"></a></h3><pre><code class="language-julia hljs">metrics = compute_metrics(rep)
println(metrics)</code></pre><p>Output:</p><pre><code class="nohighlight hljs">Metrics (14 computed):
  richness: 1523
  total_count: 50000
  shannon_entropy: 5.2341
  ...
  clonality: 0.2854
  ...</code></pre><h3 id="Accessing-Individual-Values"><a class="docs-heading-anchor" href="#Accessing-Individual-Values">Accessing Individual Values</a><a id="Accessing-Individual-Values-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-Individual-Values" title="Permalink"></a></h3><pre><code class="language-julia hljs">println(&quot;Clonality: &quot;, metrics.clonality)
println(&quot;Shannon entropy: &quot;, metrics.shannon_entropy)
println(&quot;D50: &quot;, metrics.d50)</code></pre><h3 id="Computing-Specific-Metrics"><a class="docs-heading-anchor" href="#Computing-Specific-Metrics">Computing Specific Metrics</a><a id="Computing-Specific-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-Specific-Metrics" title="Permalink"></a></h3><p>Select specific metrics using the <code>+</code> operator:</p><pre><code class="language-julia hljs"># Define which metrics to compute
selected = ShannonEntropy() + Clonality() + D50() + Chao1()

# Compute only those
result = compute_metrics(rep, selected)
println(result.shannon_entropy)
println(result.clonality)</code></pre><p>Use predefined sets:</p><pre><code class="language-julia hljs"># Diversity-focused metrics
result = compute_metrics(rep, DIVERSITY_METRICS)

# Clonality-focused metrics  
result = compute_metrics(rep, CLONALITY_METRICS)</code></pre><h3 id="Direct-Metric-Functions"><a class="docs-heading-anchor" href="#Direct-Metric-Functions">Direct Metric Functions</a><a id="Direct-Metric-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Direct-Metric-Functions" title="Permalink"></a></h3><p>For single metrics, you can also call functions directly:</p><pre><code class="language-julia hljs">H = shannon_entropy(rep)
C = clonality(rep)
d = d50(rep)</code></pre><h2 id="Multi-Donor-Analysis"><a class="docs-heading-anchor" href="#Multi-Donor-Analysis">Multi-Donor Analysis</a><a id="Multi-Donor-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-Donor-Analysis" title="Permalink"></a></h2><h3 id="Reading-Multiple-Files"><a class="docs-heading-anchor" href="#Reading-Multiple-Files">Reading Multiple Files</a><a id="Reading-Multiple-Files-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-Multiple-Files" title="Permalink"></a></h3><pre><code class="language-julia hljs"># From a list of files
files = [&quot;donor1.tsv&quot;, &quot;donor2.tsv&quot;, &quot;donor3.tsv&quot;]
collection = read_repertoires(files, VJCdr3Definition())

# From a directory
collection = read_repertoires_from_directory(&quot;data/&quot;, VJCdr3Definition())</code></pre><h3 id="Splitting-a-Multi-Donor-File"><a class="docs-heading-anchor" href="#Splitting-a-Multi-Donor-File">Splitting a Multi-Donor File</a><a id="Splitting-a-Multi-Donor-File-1"></a><a class="docs-heading-anchor-permalink" href="#Splitting-a-Multi-Donor-File" title="Permalink"></a></h3><pre><code class="language-julia hljs">using CSV, DataFrames

df = CSV.read(&quot;all_donors.tsv&quot;, DataFrame)
collection = split_by_donor(df, :library_id, VJCdr3Definition())</code></pre><h3 id="Computing-Metrics-for-All-Donors"><a class="docs-heading-anchor" href="#Computing-Metrics-for-All-Donors">Computing Metrics for All Donors</a><a id="Computing-Metrics-for-All-Donors-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-Metrics-for-All-Donors" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Compute all metrics
all_metrics = compute_metrics(collection)

# Or selected metrics
all_metrics = compute_metrics(collection, CLONALITY_METRICS)</code></pre><h3 id="Exporting-Results"><a class="docs-heading-anchor" href="#Exporting-Results">Exporting Results</a><a id="Exporting-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Exporting-Results" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Convert to DataFrame
df_results = metrics_to_dataframe(collection, all_metrics)

# Write to TSV
write_metrics(&quot;results.tsv&quot;, df_results)</code></pre><h2 id="Custom-Lineage-Definition"><a class="docs-heading-anchor" href="#Custom-Lineage-Definition">Custom Lineage Definition</a><a id="Custom-Lineage-Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Lineage-Definition" title="Permalink"></a></h2><p>For advanced use cases, define your own grouping:</p><pre><code class="language-julia hljs"># Group by V gene family only
strategy = CustomDefinition(row -&gt; begin
    v = string(row.v_call)
    # Extract family (e.g., &quot;IGHV1&quot; from &quot;IGHV1-2*01&quot;)
    m = match(r&quot;^(IGH?V\d+)&quot;, v)
    return m === nothing ? v : m.captures[1]
end)

rep = read_repertoire(&quot;data.tsv&quot;, strategy)</code></pre><h2 id="Hill-Numbers"><a class="docs-heading-anchor" href="#Hill-Numbers">Hill Numbers</a><a id="Hill-Numbers-1"></a><a class="docs-heading-anchor-permalink" href="#Hill-Numbers" title="Permalink"></a></h2><p>For a unified view of diversity across different orders:</p><pre><code class="language-julia hljs"># q=0: Richness
h0 = hill_number(rep, 0)

# q=1: exp(Shannon entropy)
h1 = hill_number(rep, 1)

# q=2: Inverse Simpson
h2 = hill_number(rep, 2)

# Arbitrary order
h_half = hill_number(rep, 0.5)</code></pre><h2 id="Comparing-Samples-of-Different-Depths"><a class="docs-heading-anchor" href="#Comparing-Samples-of-Different-Depths">Comparing Samples of Different Depths</a><a id="Comparing-Samples-of-Different-Depths-1"></a><a class="docs-heading-anchor-permalink" href="#Comparing-Samples-of-Different-Depths" title="Permalink"></a></h2><h3 id="The-Problem-with-Uneven-Sample-Sizes"><a class="docs-heading-anchor" href="#The-Problem-with-Uneven-Sample-Sizes">The Problem with Uneven Sample Sizes</a><a id="The-Problem-with-Uneven-Sample-Sizes-1"></a><a class="docs-heading-anchor-permalink" href="#The-Problem-with-Uneven-Sample-Sizes" title="Permalink"></a></h3><p>A repertoire with 100,000 sequences will almost always show more unique lineages than one with 10,000 sequences, even if the underlying distributions are identical. This is because deeper sequencing captures more rare clones.</p><h3 id="Solution-1:-Use-Depth-Robust-Metrics-(Recommended-Default)"><a class="docs-heading-anchor" href="#Solution-1:-Use-Depth-Robust-Metrics-(Recommended-Default)">Solution 1: Use Depth-Robust Metrics (Recommended Default)</a><a id="Solution-1:-Use-Depth-Robust-Metrics-(Recommended-Default)-1"></a><a class="docs-heading-anchor-permalink" href="#Solution-1:-Use-Depth-Robust-Metrics-(Recommended-Default)" title="Permalink"></a></h3><p>Many metrics work on <strong>frequencies</strong> (proportions) rather than counts. Since frequencies sum to 1.0 regardless of total count, these metrics are mathematically less sensitive to depth:</p><pre><code class="language-julia hljs"># Recommended: use the predefined ROBUST_METRICS set
metrics = compute_metrics(rep, ROBUST_METRICS)

println(&quot;Depth: &quot;, metrics.depth)  # Always report sequencing depth!
println(&quot;Simpson: &quot;, metrics.simpson_diversity)
println(&quot;Clonality: &quot;, metrics.clonality)</code></pre><p>Or select specific robust metrics:</p><pre><code class="language-julia hljs">metrics = compute_metrics(rep, Depth() + SimpsonDiversity() + Clonality() + GiniCoefficient())</code></pre><table><tr><th style="text-align: right">Metric</th><th style="text-align: right">Depth Sensitivity</th></tr><tr><td style="text-align: right">Simpson Index/Diversity</td><td style="text-align: right"><strong>Low</strong></td></tr><tr><td style="text-align: right">Inverse Simpson</td><td style="text-align: right"><strong>Low</strong></td></tr><tr><td style="text-align: right">Berger-Parker</td><td style="text-align: right"><strong>Very Low</strong></td></tr><tr><td style="text-align: right">Gini Coefficient</td><td style="text-align: right"><strong>Low</strong></td></tr><tr><td style="text-align: right">Shannon Entropy</td><td style="text-align: right">Moderate</td></tr><tr><td style="text-align: right">Richness</td><td style="text-align: right"><strong>Very High</strong></td></tr></table><p><strong>Key insight:</strong> If you have accurate count data (e.g., from UMI deduplication), the frequencies computed from your counts already reflect the true clonal distribution. Simpson-family metrics on these frequencies are directly comparable across samples.</p><h3 id="Solution-2:-Rarefaction-(For-Richness-Comparisons)"><a class="docs-heading-anchor" href="#Solution-2:-Rarefaction-(For-Richness-Comparisons)">Solution 2: Rarefaction (For Richness Comparisons)</a><a id="Solution-2:-Rarefaction-(For-Richness-Comparisons)-1"></a><a class="docs-heading-anchor-permalink" href="#Solution-2:-Rarefaction-(For-Richness-Comparisons)" title="Permalink"></a></h3><p>When you specifically need to compare <strong>richness</strong> (number of unique clones), rarefaction is the standard approach. It randomly subsamples all repertoires to the same depth.</p><p>Metrics most affected by sample size (where rarefaction helps):</p><ul><li><strong>Richness</strong> - heavily affected (more sampling = more lineages detected)</li><li><strong>Chao1</strong> - heavily affected (relies on singletons/doubletons)</li><li><strong>Shannon entropy</strong> - moderately affected</li></ul><h4 id="What-is-Rarefaction?"><a class="docs-heading-anchor" href="#What-is-Rarefaction?">What is Rarefaction?</a><a id="What-is-Rarefaction?-1"></a><a class="docs-heading-anchor-permalink" href="#What-is-Rarefaction?" title="Permalink"></a></h4><p>Rarefaction randomly subsamples a repertoire to a fixed depth (total count). By subsampling all repertoires to the same depth, you can fairly compare richness.</p><h4 id="Basic-Usage"><a class="docs-heading-anchor" href="#Basic-Usage">Basic Usage</a><a id="Basic-Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Usage" title="Permalink"></a></h4><pre><code class="language-julia hljs"># Check sample sizes
println(&quot;Rep1: &quot;, total_count(rep1))  # e.g., 50,000
println(&quot;Rep2: &quot;, total_count(rep2))  # e.g., 12,000

# Rarefy both to the smaller size
target_depth = min(total_count(rep1), total_count(rep2))
rep1_rarefied = rarefaction(rep1, target_depth)
rep2_rarefied = rarefaction(rep2, target_depth)

# Now compare fairly
metrics1 = compute_metrics(rep1_rarefied)
metrics2 = compute_metrics(rep2_rarefied)</code></pre><h4 id="Reproducibility-with-Random-Seed"><a class="docs-heading-anchor" href="#Reproducibility-with-Random-Seed">Reproducibility with Random Seed</a><a id="Reproducibility-with-Random-Seed-1"></a><a class="docs-heading-anchor-permalink" href="#Reproducibility-with-Random-Seed" title="Permalink"></a></h4><p>Rarefaction involves random sampling. For reproducible results, provide a random number generator:</p><pre><code class="language-julia hljs">using Random

rng = MersenneTwister(42)  # Fixed seed
rarefied = rarefaction(rep, 10000; rng=rng)</code></pre><h4 id="Rarefaction-Curves"><a class="docs-heading-anchor" href="#Rarefaction-Curves">Rarefaction Curves</a><a id="Rarefaction-Curves-1"></a><a class="docs-heading-anchor-permalink" href="#Rarefaction-Curves" title="Permalink"></a></h4><p>To understand how metrics change with sequencing depth, compute metrics at multiple depths:</p><pre><code class="language-julia hljs">depths = [1000, 5000, 10000, 25000, 50000]
results = []

for d in depths
    if d &lt;= total_count(rep)
        rarefied = rarefaction(rep, d)
        m = compute_metrics(rarefied, Richness() + ShannonEntropy())
        push!(results, (depth=d, richness=m.richness, shannon=m.shannon_entropy))
    end
end</code></pre><h4 id="Best-Practices-for-Rarefaction"><a class="docs-heading-anchor" href="#Best-Practices-for-Rarefaction">Best Practices for Rarefaction</a><a id="Best-Practices-for-Rarefaction-1"></a><a class="docs-heading-anchor-permalink" href="#Best-Practices-for-Rarefaction" title="Permalink"></a></h4><ol><li><strong>Choose a common depth</strong> - Use the minimum depth across all samples you want to compare</li><li><strong>Don&#39;t rarefy too aggressively</strong> - Very low depths lose too much information</li><li><strong>Consider multiple rarefactions</strong> - Average results over several random subsamples for robustness</li><li><strong>Report the depth used</strong> - Always document the rarefaction depth in your analysis</li><li><strong>Alternative: use robust metrics</strong> - Simpson index and Berger-Parker are naturally less sensitive to sample size</li></ol><h4 id="When-NOT-to-Use-Rarefaction"><a class="docs-heading-anchor" href="#When-NOT-to-Use-Rarefaction">When NOT to Use Rarefaction</a><a id="When-NOT-to-Use-Rarefaction-1"></a><a class="docs-heading-anchor-permalink" href="#When-NOT-to-Use-Rarefaction" title="Permalink"></a></h4><ul><li>When comparing samples of similar depth (within ~2-fold)</li><li>When using depth-robust metrics (Simpson, Berger-Parker, Gini)</li><li>When absolute richness (not relative comparison) is the goal</li><li>When you want to preserve information from deeply sequenced samples</li></ul><h3 id="Summary:-Depth-Strategy-Decision-Tree"><a class="docs-heading-anchor" href="#Summary:-Depth-Strategy-Decision-Tree">Summary: Depth Strategy Decision Tree</a><a id="Summary:-Depth-Strategy-Decision-Tree-1"></a><a class="docs-heading-anchor-permalink" href="#Summary:-Depth-Strategy-Decision-Tree" title="Permalink"></a></h3><pre><code class="nohighlight hljs">Do you need to compare RICHNESS specifically?
├── YES → Use rarefaction, then compare richness
└── NO → Use depth-robust metrics (Simpson, Berger-Parker, Gini)
         These work directly on frequencies and don&#39;t need rarefaction</code></pre><h2 id="Length-Metrics-(CDR3-and-more)"><a class="docs-heading-anchor" href="#Length-Metrics-(CDR3-and-more)">Length Metrics (CDR3 and more)</a><a id="Length-Metrics-(CDR3-and-more)-1"></a><a class="docs-heading-anchor-permalink" href="#Length-Metrics-(CDR3-and-more)" title="Permalink"></a></h2><p>Sequence length is an important repertoire characteristic. CDR3 length in particular is associated with binding specificity. RepertoireMetrics provides <strong>composable length metrics</strong> that integrate seamlessly with diversity metrics.</p><h3 id="Enabling-Length-Statistics"><a class="docs-heading-anchor" href="#Enabling-Length-Statistics">Enabling Length Statistics</a><a id="Enabling-Length-Statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Enabling-Length-Statistics" title="Permalink"></a></h3><p>Specify a <code>length_column</code> when creating your repertoire:</p><pre><code class="language-julia hljs">using RepertoireMetrics

# Read repertoire with CDR3 length statistics
rep = read_repertoire(&quot;sequences.tsv&quot;, VJCdr3Definition(); 
    length_column=:cdr3)  # Default: nucleotide → amino acid conversion

# Or from DataFrame
df = CSV.read(&quot;sequences.tsv&quot;, DataFrame)
rep = repertoire_from_dataframe(df, VJCdr3Definition();
    count_column=:count,
    length_column=:cdr3)</code></pre><h3 id="Accessing-Length-Statistics"><a class="docs-heading-anchor" href="#Accessing-Length-Statistics">Accessing Length Statistics</a><a id="Accessing-Length-Statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-Length-Statistics" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Direct accessors
println(&quot;Mean CDR3 length: &quot;, mean_length(rep))
println(&quot;Median: &quot;, median_length(rep))
println(&quot;Std: &quot;, std_length(rep))
println(&quot;Range: &quot;, min_length(rep), &quot; - &quot;, max_length(rep))

# Get full stats object
stats = length_stats(rep)
println(stats)</code></pre><h3 id="Composable-Length-Metrics"><a class="docs-heading-anchor" href="#Composable-Length-Metrics">Composable Length Metrics</a><a id="Composable-Length-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Composable-Length-Metrics" title="Permalink"></a></h3><p>Length metrics work with the same <code>+</code> operator as diversity metrics:</p><pre><code class="language-julia hljs"># Just length metrics
metrics = compute_metrics(rep, MeanLength() + MedianLength())

# Mix with diversity metrics
metrics = compute_metrics(rep, 
    Richness() + ShannonEntropy() + MeanLength() + StdLength())

# All length metrics at once
metrics = compute_metrics(rep, LENGTH_METRICS)</code></pre><h3 id="Flexible-Column-Selection"><a class="docs-heading-anchor" href="#Flexible-Column-Selection">Flexible Column Selection</a><a id="Flexible-Column-Selection-1"></a><a class="docs-heading-anchor-permalink" href="#Flexible-Column-Selection" title="Permalink"></a></h3><p>The <code>length_column</code> parameter accepts any column name, making it useful for:</p><ul><li>CDR3 nucleotide (<code>:cdr3</code>) - converted to AA length</li><li>CDR3 amino acid (<code>:cdr3_aa</code>) - use with <code>length_aa=true</code></li><li>Junction (<code>:junction</code>)</li><li>Any other sequence column</li></ul><pre><code class="language-julia hljs"># Using amino acid column directly
rep = read_repertoire(&quot;data.tsv&quot;, VJCdr3Definition();
    length_column=:cdr3_aa,
    length_aa=true)

# Using junction length
rep = read_repertoire(&quot;data.tsv&quot;, VJCdr3Definition();
    length_column=:junction)</code></pre><h3 id="Length-Distribution"><a class="docs-heading-anchor" href="#Length-Distribution">Length Distribution</a><a id="Length-Distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Length-Distribution" title="Permalink"></a></h3><p>For detailed analysis, get the full distribution:</p><pre><code class="language-julia hljs">dist = length_distribution(df; length_column=:cdr3, count_column=:count)

for (len, cnt) in sort(collect(dist))
    println(&quot;Length $len: $cnt sequences&quot;)
end</code></pre><h3 id="Multi-Donor-Analysis-with-Length"><a class="docs-heading-anchor" href="#Multi-Donor-Analysis-with-Length">Multi-Donor Analysis with Length</a><a id="Multi-Donor-Analysis-with-Length-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-Donor-Analysis-with-Length" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Read collection with length stats
files = [&quot;donor1.tsv&quot;, &quot;donor2.tsv&quot;]
collection = read_repertoires(files, VJCdr3Definition();
    length_column=:cdr3)

# Compute diversity + length metrics for all donors
results = compute_metrics(collection, 
    Richness() + ShannonEntropy() + MeanLength())

# Convert to DataFrame for analysis
df = metrics_to_dataframe(collection, results)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../metrics/">Metrics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 29 January 2026 13:11">Thursday 29 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
